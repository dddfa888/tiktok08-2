{"remainingRequest":"C:\\Users\\HP\\Desktop\\tk08\\tiktok08\\buyPC\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\HP\\Desktop\\tk08\\tiktok08\\buyPC\\src\\page\\userInfo\\my-order\\order-evaluation.vue?vue&type=style&index=0&id=56eb95be&lang=scss&scoped=true","dependencies":[{"path":"C:\\Users\\HP\\Desktop\\tk08\\tiktok08\\buyPC\\src\\page\\userInfo\\my-order\\order-evaluation.vue","mtime":1760944158225},{"path":"C:\\Users\\HP\\Desktop\\tk08\\tiktok08\\buyPC\\node_modules\\css-loader\\dist\\cjs.js","mtime":1761044715569},{"path":"C:\\Users\\HP\\Desktop\\tk08\\tiktok08\\buyPC\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1761044717168},{"path":"C:\\Users\\HP\\Desktop\\tk08\\tiktok08\\buyPC\\node_modules\\postcss-loader\\src\\index.js","mtime":1761044716266},{"path":"C:\\Users\\HP\\Desktop\\tk08\\tiktok08\\buyPC\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1761044715084},{"path":"C:\\Users\\HP\\Desktop\\tk08\\tiktok08\\buyPC\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1761044715083},{"path":"C:\\Users\\HP\\Desktop\\tk08\\tiktok08\\buyPC\\node_modules\\vue-loader\\lib\\index.js","mtime":1761044716737}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouZXZhbHVhdGlvbi1saXN0IHsNCiAgL2RlZXAvIC5lbC11cGxvYWQtLXBpY3R1cmUtY2FyZCB7DQogICAgd2lkdGg6IDcwcHg7DQogICAgaGVpZ2h0OiA3MHB4Ow0KICB9DQoNCiAgL2RlZXAvIC5lbC11cGxvYWQgew0KICAgIHdpZHRoOiA3MHB4Ow0KICAgIGhlaWdodDogNzBweDsNCiAgICBsaW5lLWhlaWdodDogNzBweDsNCiAgfQ0KDQogIC9kZWVwLyAuZWwtdXBsb2FkLWxpc3QtLXBpY3R1cmUtY2FyZCAuZWwtdXBsb2FkLWxpc3RfX2l0ZW0gew0KICAgIHdpZHRoOiA3MHB4Ow0KICAgIGhlaWdodDogNzBweDsNCiAgICBsaW5lLWhlaWdodDogNzBweDsNCiAgfQ0KDQogIC9kZWVwLyAuZWwtdXBsb2FkLWxpc3QtLXBpY3R1cmUtY2FyZCAuZWwtdXBsb2FkLWxpc3RfX2l0ZW0tdGh1bWJuYWlsIHsNCiAgICB3aWR0aDogNzBweDsNCiAgICBoZWlnaHQ6IDcwcHg7DQogICAgbGluZS1oZWlnaHQ6IDcwcHg7DQogIH0NCg0KICAuZXZhbHVhdGlvbi1pdGVtIHsNCiAgICArIC5ldmFsdWF0aW9uLWl0ZW0gew0KICAgICAgbWFyZ2luLXRvcDogMThweDsNCiAgICB9DQoNCiAgICAucHJvZHVjdC1pdGVtIHsNCiAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICBmbGV4LWRpcmVjdGlvbjogcm93Ow0KDQogICAgICBpbWcgew0KICAgICAgICB3aWR0aDogNjJweDsNCiAgICAgICAgaGVpZ2h0OiA2MnB4Ow0KICAgICAgfQ0KDQogICAgICAuaW5mbyB7DQogICAgICAgIG1hcmdpbi1sZWZ0OiAxOHB4Ow0KICAgICAgICBmbGV4OiAxOw0KDQogICAgICAgIC5wcmljZSB7DQogICAgICAgICAgZm9udC13ZWlnaHQ6IDUwMDsNCiAgICAgICAgICBmb250LXNpemU6IDE2cHg7DQogICAgICAgICAgY29sb3I6IHZhcigtLWNvbG9yLW1haW4pOw0KICAgICAgICAgIG1hcmdpbi10b3A6IDhweDsNCiAgICAgICAgfQ0KDQogICAgICAgIC5lbC1yYXRlIHsNCiAgICAgICAgICBtYXJnaW4tdG9wOiA1cHg7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQoNCiAgICAuY29udGVudCB7DQogICAgICBtYXJnaW4tdG9wOiAyNXB4Ow0KDQogICAgICAuZWwtdGV4dGFyZWFfX2lubmVyIHsNCiAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2VmZWZlZjsNCiAgICAgICAgaGVpZ2h0OiA3MHB4Ow0KICAgICAgfQ0KICAgIH0NCiAgfQ0KfQ0KDQouYWN0aW9uIHsNCiAgLy8gcGFkZGluZzogMjBweCAwOw0KICBkaXNwbGF5OiBmbGV4Ow0KICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAvLyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgbWFyZ2luLXRvcDogNTJweDsNCiAgbWFyZ2luLWxlZnQ6IDM0cHg7DQoNCiAgLmVsLWJ1dHRvbiB7DQogICAgd2lkdGg6IDQ4MHB4Ow0KICAgIGhlaWdodDogNDRweDsNCiAgICBjb2xvcjogI2ZmZjsNCiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1jb2xvci1tYWluKTsNCiAgICBib3JkZXItY29sb3I6IHZhcigtLWNvbG9yLW1haW4pOw0KICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgfQ0KfQ0K"},{"version":3,"sources":["order-evaluation.vue"],"names":[],"mappings":";AA2TA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"order-evaluation.vue","sourceRoot":"src/page/userInfo/my-order","sourcesContent":["<template>\r\n  <div\r\n    class=\"evaluation-list\"\r\n    style=\"width: 866px; margin-top: 24px\"\r\n    v-loading=\"loading\"\r\n  >\r\n    <div\r\n      class=\"page-title\"\r\n      style=\"cursor: pointer; margin-bottom: 20px; margin-left: 34px\"\r\n      @click=\"goBack\"\r\n    >\r\n      <i class=\"el-icon-arrow-left\"></i> {{ $t(\"message.home.myOrder\") }}/{{\r\n        $t(\"message.home.Submitareview\")\r\n      }}\r\n    </div>\r\n    <div\r\n      class=\"evaluation-item\"\r\n      v-for=\"(item, index) in orderGoods\"\r\n      :key=\"item.id\"\r\n    >\r\n      <div style=\"margin-left: 40px; margin-top: 30px\">\r\n        <div class=\"product-item\">\r\n          <el-image\r\n            style=\"width: 62px; height: 62px\"\r\n            fit=\"scale-down\"\r\n            :src=\"item.goodsIcon\"\r\n            alt=\"order-detail-product\"\r\n          />\r\n          <div class=\"info\">\r\n            <div class=\"tit\">{{ item.goodsName }}</div>\r\n            <div\r\n              style=\"margin-top: 9px; font-size: 12px\"\r\n              v-if=\"item.attributes && item.attributes.length > 0\"\r\n            >\r\n              {{\r\n                item.attributes\r\n                  .map((it) => `${it.attrName}:${it.attrValue}`)\r\n                  .join(\" \")\r\n              }}\r\n            </div>\r\n            <div class=\"price\">${{ numberFormatFn(item.goodsReal) }}</div>\r\n            <el-rate\r\n              v-model=\"rateMap[item.goodsId]\"\r\n              :disabled=\"resultMap[item.goodsId]\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <el-input\r\n          v-model=\"contentMap[item.goodsId]\"\r\n          class=\"content\"\r\n          type=\"textarea\"\r\n          :placeholder=\"$t('message.home.evaluateOrderPlaceholder')\"\r\n          resize=\"none\"\r\n          :disabled=\"resultMap[item.goodsId]\"\r\n          :maxlength=\"1000\"\r\n          show-word-limit\r\n        />\r\n\r\n        <div style=\"height: 15px\" />\r\n\r\n        <span>{{ $t(\"message.home.evaluateInput\") }}</span>\r\n\r\n        <el-upload\r\n          :data=\"uploadParams\"\r\n          style=\"margin-top: 10px\"\r\n          :action=\"UploadApi\"\r\n          :on-change=\"(_, files) => handleFilesChange(files, item.goodsId)\"\r\n          list-type=\"picture-card\"\r\n          :disabled =\"isUpload\"\r\n        >\r\n          <img\r\n            src=\"@/assets/image/bxs_camera-plus.png\"\r\n            style=\"width: 25.54px; height: 22.81px\"\r\n          />\r\n          <div slot=\"file\" slot-scope=\"{ file }\">\r\n            <img\r\n              class=\"el-upload-list__item-thumbnail\"\r\n              :src=\"file.url\"\r\n              alt=\"\"\r\n            />\r\n            <span class=\"el-upload-list__item-actions\">\r\n              <span\r\n                class=\"el-upload-list__item-preview\"\r\n                @click=\"handlePictureCardPreview(file)\"\r\n              >\r\n                <i class=\"el-icon-zoom-in\"></i>\r\n              </span>\r\n              <span\r\n                v-if=\"!disabled\"\r\n                class=\"el-upload-list__item-delete\"\r\n                @click=\"handleRemove(file, item.goodsId)\"\r\n              >\r\n                <i class=\"el-icon-delete\"></i>\r\n              </span>\r\n            </span>\r\n          </div>\r\n        </el-upload>\r\n      </div>\r\n      <el-divider v-if=\"index < orderGoods.length - 1\"></el-divider>\r\n    </div>\r\n    <div class=\"action\">\r\n      <el-button @click=\"submit\" :disabled=\"disabled\">\r\n        {{ $t(\"message.home.Submitareview\") }}\r\n      </el-button>\r\n    </div>\r\n    <el-dialog :visible.sync=\"dialogVisible\">\r\n      <img width=\"100%\" :src=\"dialogImageUrl\" alt=\"\" />\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapGetters, mapActions } from \"vuex\";\r\nimport { numberFormat } from \"@/util\";\r\nimport { UploadApi, AddOrderEvaluateList } from \"@/api\";\r\nexport default {\r\n  name: \"order-evaluation-dialog\",\r\n  props: {\r\n    value: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n    // currentOrderInfo: {\r\n    //     type: Object,\r\n    //     default: () => { },\r\n    // },\r\n    refresh: {\r\n      type: Function,\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      // currentOrderInfo: this.$route.params?.currentOrderInfo || {},\r\n      // dialogVisible: this.value || false,\r\n      orderId: this.$route.query.orderId,\r\n      loading: false,\r\n      rateMap: {},\r\n      contentMap: {},\r\n      imagesMap: {},\r\n      resultMap: {},\r\n      dialogImageUrl: \"\",\r\n      isUpload:false,\r\n      dialogVisible: false,\r\n      disabled: false,\r\n      UploadApi,\r\n      uploadParams: {\r\n        moduleName: \"evaluate\",\r\n        token: localStorage.getItem(\"ES_TOKEN\"),\r\n      },\r\n    };\r\n  },\r\n  mounted() {\r\n    if (this.orderId) {\r\n      this.requestData();\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapGetters({\r\n      orderGoods: \"order/orderGoods\",\r\n    }),\r\n  },\r\n  watch: {\r\n    orderGoods(newValue) {\r\n      let rateMap = {};\r\n      let contentMap = {};\r\n      let resultMap = {};\r\n\r\n      newValue.forEach((item) => {\r\n        rateMap[item.goodsId] = 5;\r\n        contentMap[item.goodsId] = \"\";\r\n        resultMap[item.goodsId] = false;\r\n      });\r\n\r\n      this.rateMap = { ...rateMap };\r\n      this.contentMap = { ...contentMap };\r\n      this.resultMap = { ...resultMap };\r\n    },\r\n\r\n  },\r\n  methods: {\r\n    ...mapActions({\r\n      requestOrderGoodsList: \"order/requestOrderGoodsList\",\r\n      requestOrderEvaluationList: \"order/requestOrderEvaluationList\",\r\n    }),\r\n    uploadFile(params, goodsId) {\r\n      console.log(goodsId, params);\r\n    },\r\n\r\n    handleRemove(file, goodsId) {\r\n      const index = this.imagesMap[goodsId]?.findIndex(\r\n        (x) => x.uid == file.uid\r\n      );\r\n      index >= 0 && this.imagesMap[goodsId]?.splice(index, 1);\r\n    },\r\n    handlePictureCardPreview(file) {\r\n      this.dialogImageUrl = file.url;\r\n      this.dialogVisible = true;\r\n    },\r\n\r\n    handleFilesChange(files, goodsId) {\r\n      if (files.length >8) {\r\n        this.$message.warning(this.$t(\"message.home.最多上传9张图片\"));\r\n        this.isUpload = true\r\n      }else{\r\n        this.imagesMap[goodsId] = files;\r\n      }\r\n      \r\n    },\r\n\r\n    goBack() {\r\n      this.$router.push(\"/userInfo/my-order\");\r\n    },\r\n    getRate(id) {\r\n      if (this.rateMap[id] < 2) {\r\n        return 3;\r\n      } else if (this.rateMap[id] < 4) {\r\n        return 2;\r\n      }\r\n      return 1;\r\n    },\r\n    async requestData() {\r\n      try {\r\n        this.loading = true;\r\n        await this.requestOrderGoodsList({ orderId: this.orderId });\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n    async submit() {\r\n      // const content = this.contentMap[item.goodsId]?.trim() ?? ''\r\n      // if (!content) {\r\n      //   this.$message.warning(this.$t('message.home.evaluateOrderPlaceholder'))\r\n      //   return\r\n      // }\r\n\r\n      try {\r\n        this.btnLoading = true;\r\n        this.disabled = true;\r\n        // await this.requestOrderEvaluationList({\r\n        //     sellerGoodsId: item.goodsId,\r\n        //     evaluationType: this.getRate(),\r\n        //     rating: this.rateMap[item.goodsId],\r\n        //     orderId: this.orderId,\r\n        //     content: content || this.$t('message.home.defaultRate'),\r\n        // })\r\n        // this.resultMap[item.goodsId] = true\r\n        const evaluationAdds = [];\r\n        // const canContinue = true;\r\n        for (let { goodsId } of this.orderGoods) {\r\n          const evaluation = {\r\n            sellerGoodsId: goodsId,\r\n            evaluationType: this.getRate(goodsId),\r\n            rating: this.rateMap[goodsId],\r\n            content: this.contentMap[goodsId],\r\n          };\r\n\r\n          const notUpload = this.imagesMap[goodsId]?.filter((x) => !x.response);\r\n\r\n          if (notUpload && notUpload.length > 0) {\r\n            this.$message({\r\n              // title: this.$t('message.home.successTips'),\r\n              message: this.$t(\"message.home.evaluationUploading\"),\r\n              type: \"error\",\r\n            });\r\n            return;\r\n          }\r\n\r\n          const imageUrls =\r\n            this.imagesMap[goodsId]\r\n              ?.filter((x) => x.response && x.response.code == \"0\")\r\n              .map((x) => x.response.data) || [];\r\n\r\n          for (let i = 0; i < imageUrls.length; i++) {\r\n            evaluation[`imgUrl${i + 1}`] = imageUrls[i];\r\n          }\r\n          evaluationAdds.push(evaluation);\r\n        }\r\n\r\n        let res = await AddOrderEvaluateList({\r\n          orderId: this.orderId,\r\n          evaluationAdds,\r\n        });\r\n\r\n        if (res.code == 0) {\r\n          this.$router.push({path:\"/userInfo/my-order\",replace:true});\r\n          this.$notify({\r\n            title: this.$t(\"message.home.successTips\"),\r\n            message: this.$t(\"message.home.evaluateOrderSuccess\"),\r\n            type: \"success\",\r\n          });\r\n        }else{\r\n          // this.$message({\r\n          //   title: this.$t('message.home.fuilTips'),\r\n          //   message: this.$t(\"message.home.evaluateOrderFuil\"),\r\n          //   type: \"error\",\r\n          // });\r\n        }\r\n\r\n        // this.$emit(\"closeDetails\");\r\n        // this.refresh && this.refresh()\r\n      } finally {\r\n        this.btnLoading = false;\r\n        this.disabled = false;\r\n      }\r\n    },\r\n\r\n    numberFormatFn(num) {\r\n      return numberFormat(num);\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.evaluation-list {\r\n  /deep/ .el-upload--picture-card {\r\n    width: 70px;\r\n    height: 70px;\r\n  }\r\n\r\n  /deep/ .el-upload {\r\n    width: 70px;\r\n    height: 70px;\r\n    line-height: 70px;\r\n  }\r\n\r\n  /deep/ .el-upload-list--picture-card .el-upload-list__item {\r\n    width: 70px;\r\n    height: 70px;\r\n    line-height: 70px;\r\n  }\r\n\r\n  /deep/ .el-upload-list--picture-card .el-upload-list__item-thumbnail {\r\n    width: 70px;\r\n    height: 70px;\r\n    line-height: 70px;\r\n  }\r\n\r\n  .evaluation-item {\r\n    + .evaluation-item {\r\n      margin-top: 18px;\r\n    }\r\n\r\n    .product-item {\r\n      display: flex;\r\n      flex-direction: row;\r\n\r\n      img {\r\n        width: 62px;\r\n        height: 62px;\r\n      }\r\n\r\n      .info {\r\n        margin-left: 18px;\r\n        flex: 1;\r\n\r\n        .price {\r\n          font-weight: 500;\r\n          font-size: 16px;\r\n          color: var(--color-main);\r\n          margin-top: 8px;\r\n        }\r\n\r\n        .el-rate {\r\n          margin-top: 5px;\r\n        }\r\n      }\r\n    }\r\n\r\n    .content {\r\n      margin-top: 25px;\r\n\r\n      .el-textarea__inner {\r\n        border: 1px solid #efefef;\r\n        height: 70px;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n.action {\r\n  // padding: 20px 0;\r\n  display: flex;\r\n  align-items: center;\r\n  // justify-content: center;\r\n  margin-top: 52px;\r\n  margin-left: 34px;\r\n\r\n  .el-button {\r\n    width: 480px;\r\n    height: 44px;\r\n    color: #fff;\r\n    background: var(--color-main);\r\n    border-color: var(--color-main);\r\n    border-radius: 4px;\r\n  }\r\n}\r\n</style>\r\n"]}]}