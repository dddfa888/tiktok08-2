{"ast":null,"code":"import \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"core-js/modules/es.array-buffer.detached.js\";\nimport \"core-js/modules/es.array-buffer.transfer.js\";\nimport \"core-js/modules/es.array-buffer.transfer-to-fixed-length.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\nimport \"core-js/modules/esnext.uint8-array.set-from-base64.js\";\nimport \"core-js/modules/esnext.uint8-array.set-from-hex.js\";\nimport \"core-js/modules/esnext.uint8-array.to-base64.js\";\nimport \"core-js/modules/esnext.uint8-array.to-hex.js\";\nimport \"core-js/modules/web.dom-exception.stack.js\";\nimport { uploadimg, upload } from \"@/API/commodity\";\nimport vueEsign from \"vue-esign\";\nimport html2Canvas from \"html2canvas\";\nimport JsPDF from \"jspdf\";\nexport default {\n  name: \"merchantSettled\",\n  data() {\n    return {\n      lineWidth: 6,\n      lineColor: \"#000000\",\n      bgColor: \"\",\n      resultImg: \"\",\n      // esignImg: \"\",\n      isCrop: false,\n      visible: false,\n      itemname: '',\n      showPassword: true,\n      showPassword2: true,\n      tjbtn: true,\n      isCutting: false,\n      // 是否裁剪\n      showUpLoader: true,\n      step: 2,\n      show: true,\n      checked: false,\n      screenWidth: document.body.clientWidth,\n      signPdfUrl: \"\",\n      token: \"\",\n      pageDiaCode: true,\n      renderComponent: true,\n      blob: null,\n      now_date: \"\"\n    };\n  },\n  computed: {\n    isOverSize() {\n      return 4000 * 1024;\n    },\n    isPC() {\n      let userAgentInfo = navigator.userAgent;\n      let Agents = [\"Android\", \"iPhone\", \"SymbianOS\", \"Windows Phone\", \"iPad\", \"iPod\"];\n      let flag = true;\n      for (let v = 0; v < Agents.length; v++) {\n        if (userAgentInfo.indexOf(Agents[v]) > 0) {\n          flag = false;\n          break;\n        }\n      }\n      return flag;\n    }\n  },\n  components: {\n    // cropperjs,\n    vueEsign\n    // Uploader,\n  },\n  created() {\n    if (this.screenWidth >= 500) {\n      this.labelPosition = \"left\";\n    } else {\n      this.labelPosition = \"top\";\n    }\n    if (this.$route.query.usercode) {\n      localStorage.setItem(\"usercode\", this.$route.query.usercode);\n      this.ruleForm.usercode = this.$route.query.usercode;\n    }\n    if (this.isPC) {\n      this.scrollDisbled = false;\n    }\n    this.getNowFormatDate();\n  },\n  mounted() {\n    this.token = sessionStorage.getItem('SellToken');\n    this.itemname = sessionStorage.getItem('itemName');\n    console.log('this.name ->', this.itemname);\n  },\n  methods: {\n    // 上传签名\n    uploadSign() {\n      upload({\n        token: this.token,\n        signPdfUrl: this.signPdfUrl + ''\n      }).then(res => {\n        console.log('res ->', res);\n        if (res == \"success\") {\n          _Toast(this.$t(\"成功\"));\n          setTimeout(() => {\n            window.top.closePopup && window.top.closePopup();\n          }, 1000);\n        } else {\n          _Toast(this.$t(\"失败\"));\n        }\n      });\n    },\n    reset() {\n      this.$refs.esign.reset();\n    },\n    goback() {\n      this.$refs.esign.reset();\n      this.visible = false;\n    },\n    getNowFormatDate() {\n      let date = new Date(),\n        year = date.getFullYear(),\n        //获取完整的年份(4位)\n        month = date.getMonth() + 1,\n        //获取当前月份(0-11,0代表1月)\n        strDate = date.getDate(); // 获取当前日(1-31)\n      if (month < 10) month = `0${month}`; // 如果月份是个位数，在前面补0\n      if (strDate < 10) strDate = `0${strDate}`; // 如果日是个位数，在前面补0\n\n      this.now_date = `${year}-${month}-${strDate}`;\n    },\n    // 保存\n    save() {\n      // 可选配置参数 ，在未设置format或quality属性时可在生成图片时配置 例如： {format:'image/jpeg', quality: 0.5}\n      this.$refs.esign.generate({\n        format: \"image/jpeg\",\n        quality: 0.5\n      });\n      this.$refs.esign.generate().then(res => {\n        // console.log('res ->', res);\n        this.resultImg = res;\n        // this.$emit(\"finsih\",res)\n        this.visible = false;\n        setTimeout(() => {\n          this.getImg();\n        }, 2000);\n      }).catch(err => {\n        // 画布没有签字时会执行这里 'Not Signned'\n        // this.$message.error(\"您还未完成签字，请签字完成后保存\");\n        _Toast(this.$t(\"请签字后再提交\"));\n      });\n    },\n    argeementEsign() {\n      if (this.signPdfUrl) {\n        this.uploadSign();\n      } else {\n        _Toast(this.$t(\"请签字后再提交\"));\n      }\n    },\n    dataURLtoBlob(dataurl) {\n      let arr = dataurl.split(\",\"),\n        mime = arr[0].match(/:(.*?);/)[1],\n        bstr = atob(arr[1]),\n        n = bstr.length,\n        u8arr = new Uint8Array(n);\n      while (n--) {\n        u8arr[n] = bstr.charCodeAt(n);\n      }\n      return new Blob([u8arr], {\n        type: mime\n      });\n    },\n    blobToFile(theBlob, fileName) {\n      theBlob.lastModifiedDate = new Date();\n      theBlob.name = fileName;\n      return theBlob;\n    },\n    convertBase64ToFile(urlData, filename) {\n      var arr = urlData.split(\"base64,\");\n      var type = arr[0].match(/:(.*?);/)[1];\n      var fileExt = type.split(\"/\")[1];\n      var bstr = atob(arr[1]);\n      var n = bstr.length;\n      var u8arr = new Uint8Array(n);\n      while (n--) {\n        u8arr[n] = bstr.charCodeAt(n);\n      }\n      return new File([u8arr], filename + \".\" + fileExt, {\n        type: type\n      });\n    },\n    getImg() {\n      this.$refs.capture.scrollTop = 0;\n      html2Canvas(this.$refs.capture, {\n        allowTaint: true,\n        useCORS: true\n      }).then(canvas => {\n        //内容的宽度\n        let contentWidth = canvas.width;\n        //内容高度\n        let contentHeight = canvas.height;\n        //一页pdf显示html页面生成的canvas高度,a4纸的尺寸[595.28,841.89];\n        let pageHeight = contentWidth / 592.28 * 841.89;\n        //未生成pdf的html页面高度\n        let leftHeight = contentHeight;\n        //页面偏移\n        let position = 0;\n        //a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高\n        let imgWidth = 595.28;\n        let imgHeight = 592.28 / contentWidth * contentHeight;\n        //canvas转图片数据\n        let pageData = canvas.toDataURL(\"image/jpeg\", 1.0);\n        //新建JsPDF对象\n        let PDF = new JsPDF(\"\", \"pt\", \"a4\");\n        //判断是否分页\n        if (leftHeight < pageHeight) {\n          PDF.addImage(pageData, \"JPEG\", 10, 0, imgWidth, imgHeight);\n        } else {\n          while (leftHeight > 0) {\n            PDF.addImage(pageData, \"JPEG\", 10, position, imgWidth, imgHeight);\n            leftHeight -= pageHeight;\n            position -= 841.89;\n            if (leftHeight > 0) {\n              PDF.addPage();\n            }\n          }\n        }\n        this.tjbtn = true;\n        let blob = this.convertBase64ToFile(PDF.output(\"dataurlstring\"), \"esign.pdf\");\n        console.log(\"blob ->\", blob);\n        let fileOfBlob = new File([blob], \"esign.pdf\");\n        // console.log(\"fileOfBlob ->\", fileOfBlob);\n        let formData = new FormData(); //通过formdata上传\n        formData.append(\"file\", fileOfBlob);\n        formData.append(\"moduleName\", \"seller\");\n        // console.log('formData ->', formData.get(\"file\"));\n        _Toast.loading({\n          duration: 0,\n          message: this.$t(\"上传中\"),\n          forbidClick: true\n        });\n        uploadimg(formData).then(res => {\n          this.signPdfUrl = res;\n          this.tjbtn = false;\n          _Toast(this.$t(\"签名成功\"));\n          // this.show = false;\n          // this.checked = true;\n        }).catch(function () {\n          _Toast.clear();\n          _Toast(this.$t(\"失败\"));\n          this.signPdfUrl = \"\";\n        });\n      });\n    },\n    handleScroll(e) {\n      const {\n        scrollTop,\n        clientHeight,\n        scrollHeight\n      } = e.target;\n      console.log(scrollTop, clientHeight, scrollHeight);\n      if (scrollTop + clientHeight + 2 >= scrollHeight) {\n        // alert('滚动到底部啦')\n        this.scrollDisbled = false;\n      }\n    },\n    open() {\n      // console.log('this.checked ->', this.checked);\n      if (this.checked == true) {\n        this.checked = false;\n      }\n      this.checked = false;\n      if (this.checked == false) {\n        this.show = true;\n      }\n    },\n    agreement() {\n      this.visible = true;\n      // this.show=false;\n      // this.checked=true;\n    },\n    closeAgreement() {\n      this.show = false;\n      this.checked = false;\n    },\n    onOversize(file) {\n      console.log(file);\n      _Toast(this.$t(\"文件大小不能超过 4Mb\"));\n    },\n    // 裁剪\n    handleCutting() {\n      this.isCutting = true;\n    },\n    // 取消\n    handleCancel() {\n      this.isCutting = false;\n      this.fileList1 = [];\n    },\n    // 上传\n    handleUpload(data) {\n      let fileOfBlob = new File([data], \"logo.png\"); // 重命名\n      this.isCutting = false;\n      _Toast.loading({\n        duration: 0,\n        message: this.$t(\"上传中\"),\n        forbidClick: true\n      });\n      let formData = new FormData(); //通过formdata上传\n      formData.append(\"file\", fileOfBlob);\n      formData.append(\"moduleName\", \"selle\");\n      uploadimg(formData).then(data => {\n        _Toast.clear();\n        this.ruleForm.sellerImg = data;\n        console.log(\"data ->\", data);\n        this.fileList1[0].content = data;\n        // this.fileList1[0].file=fileOfBlob\n      }).catch(function () {\n        _Toast.clear();\n        _Toast(this.$t(\"失败\"));\n        this.fileList1 = [];\n      });\n    },\n    updateMerchantInfo(data) {\n      this.ruleForm.sellerImg = data;\n    },\n    handleCropData(data) {\n      console.log(\"裁剪数据\");\n      console.log(data);\n    },\n    handleSetLang(index) {\n      console.log(index);\n      // 设置i18n.locale 组件库会按照上面的配置使用对应的文案文件\n      this.$i18n.locale = this.lang[index].key;\n      // // 提交mutations\n      this.setLanguage(this.lang[index].key);\n    },\n    changeCountry(val) {\n      console.log(val);\n      this.ruleForm.country = val;\n    },\n    //商户注册\n\n    goPage() {\n      if (window?.plus) {\n        window.open(window.origin + \"/www\", \"_self\");\n      } else if (this.pc) {\n        window.open(\"https://\" + window.location.hostname + \"/ww\");\n      } else {\n        window.open(\"https://\" + window.location.hostname + \"/ww\");\n      }\n    },\n    stepFun() {\n      if (!this.checked) {\n        _Toast(this.$t(\"请同意入驻协议\"));\n        return;\n      }\n      this.step = 2;\n      this.$el.querySelector(\"#product\").scrollIntoView({\n        behavior: \"smooth\"\n      });\n    },\n    // openNationality(index) {\n    //     const t = this;\n    //     if (index === 1) {\n    //         this.isCode = true;\n    //     } else {\n    //         this.isCode = false;\n    //     }\n    //     this.$refs.controlChild.open();\n    //     t.renderComponent = false;\n    //     // this.$forceUpdate()\n    //     t.$nextTick().then(() => {\n    //         t.renderComponent = true;\n    //         t.$nextTick().then(() => {\n    //             t.sj();\n    //         });\n    //     });\n    // },\n    // sj() {\n    //     this.$refs.controlChild.open2();\n    //     this.$refs.controlChild.open();\n    // },\n    // getName(params) {\n    //     if (this.isCode) {\n    //         this.areaCode = params[2];\n    //     } else {\n    //         this.ruleForm.nationality = params[0];\n    //     }\n    // },\n    //文件上传\n    // avatarAfterRead(file) {\n    //     this.imgFile = file.content;\n    //     this.isCutting = true;\n    // },\n    //文件上传\n    paperworkAfterRead(file, fileIndex) {\n      console.log(\"fileIndex ->\", fileIndex);\n      const that = this;\n      _Toast.loading({\n        duration: 0,\n        message: that.$t(\"上传中\"),\n        forbidClick: true\n      });\n      let formData = new FormData(); //通过formdata上传\n      formData.append(\"file\", file.file);\n      formData.append(\"moduleName\", \"selle\");\n      uploadimg(formData).then(data => {\n        _Toast.clear();\n        that.ruleForm[`idimg_${fileIndex}`] = data;\n      }).catch(() => {\n        _Toast.clear();\n        _Toast(that.$t(\"失败\"));\n        that[`fileList${fileIndex + 1}`] = [];\n      });\n      if (fileIndex == 0) {\n        uploadimg(formData).then(data => {\n          _Toast.clear();\n          _Toast(that.$t(\"成功\"));\n          that.ruleForm.sellerImg = data;\n        }).catch(() => {\n          _Toast.clear();\n          _Toast(that.$t(\"失败\"));\n          that.ruleForm.sellerImg = [];\n        });\n      }\n    }\n  },\n  beforeDestroy() {\n    _Toast.clear();\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}