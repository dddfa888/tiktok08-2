import{b7 as me,b8 as Z,aq as le,e as se,b9 as p,at as fe,aH as ve,as as ee,ba as ie,r as S,p as he,aI as ge,ar as F,ay as ce,f as W,b as d,aJ as ue,aC as G,ax as L,aG as xe,aw as be,aD as Ce,m as X,bb as ye,X as Te,bc as te,bd as Ie,av as we}from"./index-55507c28.js";function R(t){if(!me(t))return t;if(Array.isArray(t))return t.map(r=>R(r));if(Z(t)){const r={};return Object.keys(t).forEach(i=>{r[i]=R(t[i])}),r}return t}const ne=200,ae=300,Oe=15,[re,j]=le("picker-column");function Ne(t){const{transform:r}=window.getComputedStyle(t),i=r.slice(7,r.length-1).split(", ")[5];return Number(i)}const de=Symbol(re),Q=t=>Z(t)&&t.disabled;var Pe=se({name:re,props:{textKey:p(String),readonly:Boolean,allowHtml:Boolean,className:fe,itemHeight:p(Number),defaultIndex:ve(0),swipeDuration:p(ee),initialOptions:ie(),visibleItemCount:p(ee)},emits:["change"],setup(t,{emit:r,slots:i}){let h,y,g,c,m;const H=S(),T=S(),o=he({index:t.defaultIndex,offset:0,duration:0,options:R(t.initialOptions)}),w=ge(),O=()=>o.options.length,N=()=>t.itemHeight*(+t.visibleItemCount-1)/2,D=n=>{n=G(n,0,O());for(let l=n;l<O();l++)if(!Q(o.options[l]))return l;for(let l=n-1;l>=0;l--)if(!Q(o.options[l]))return l},f=(n,l)=>{n=D(n)||0;const u=-n*t.itemHeight,v=()=>{n!==o.index&&(o.index=n,l&&r("change",n))};h&&u!==o.offset?m=v:v(),o.offset=u},b=n=>{JSON.stringify(n)!==JSON.stringify(o.options)&&(o.options=R(n),f(t.defaultIndex))},k=n=>{h||t.readonly||(m=null,o.duration=ne,f(n,!0))},E=n=>Z(n)&&t.textKey in n?n[t.textKey]:n,P=n=>G(Math.round(-n/t.itemHeight),0,O()-1),_=(n,l)=>{const u=Math.abs(n/l);n=o.offset+u/.003*(n<0?-1:1);const v=P(n);o.duration=+t.swipeDuration,f(v,!0)},B=()=>{h=!1,o.duration=0,m&&(m(),m=null)},M=n=>{if(!t.readonly){if(w.start(n),h){const l=Ne(T.value);o.offset=Math.min(0,l-N()),y=o.offset}else y=o.offset;o.duration=0,g=Date.now(),c=y,m=null}},U=n=>{if(t.readonly)return;w.move(n),w.isVertical()&&(h=!0,ue(n,!0)),o.offset=G(y+w.deltaY.value,-(O()*t.itemHeight),t.itemHeight);const l=Date.now();l-g>ae&&(g=l,c=o.offset)},V=()=>{if(t.readonly)return;const n=o.offset-c,l=Date.now()-g;if(l<ae&&Math.abs(n)>Oe){_(n,l);return}const v=P(o.offset);o.duration=ne,f(v,!0),setTimeout(()=>{h=!1},0)},A=()=>{const n={height:"".concat(t.itemHeight,"px")};return o.options.map((l,u)=>{const v=E(l),$=Q(l),q={role:"button",style:n,tabindex:$?-1:0,class:j("item",{disabled:$,selected:u===o.index}),onClick:()=>k(u)},z={class:"van-ellipsis",[t.allowHtml?"innerHTML":"textContent"]:v};return d("li",q,[i.option?i.option(l):d("div",z,null)])})},Y=n=>{const{options:l}=o;for(let u=0;u<l.length;u++)if(E(l[u])===n)return f(u)},K=()=>o.options[o.index],J=()=>o.options.length;return f(o.index),F.useParent(de),ce({state:o,setIndex:f,getValue:K,setValue:Y,setOptions:b,hasOptions:J,stopMomentum:B}),W(()=>t.initialOptions,b),W(()=>t.defaultIndex,n=>f(n)),F.useEventListener("touchmove",U,{target:H}),()=>d("div",{ref:H,class:[j(),t.className],onTouchstartPassive:M,onTouchend:V,onTouchcancel:V},[d("ul",{ref:T,style:{transform:"translate3d(0, ".concat(o.offset+N(),"px, 0)"),transitionDuration:"".concat(o.duration,"ms"),transitionProperty:o.duration?"all":"none"},class:j("wrapper"),onTransitionend:B},[A()])])}});const[ke,x,oe]=le("picker"),Ee={title:String,loading:Boolean,readonly:Boolean,allowHtml:Boolean,itemHeight:L(44),showToolbar:xe,swipeDuration:L(1e3),visibleItemCount:L(6),cancelButtonText:String,confirmButtonText:String},Me=be({},Ee,{columns:ie(),valueKey:String,defaultIndex:L(0),toolbarPosition:Ce("top"),columnsFieldNames:Object});var Se=se({name:ke,props:Me,emits:["confirm","cancel","change"],setup(t,{emit:r,slots:i}){const h=S(!1),y=S(),g=S([]),c=X(()=>{const{columnsFieldNames:e}=t;return{text:(e==null?void 0:e.text)||t.valueKey||"text",values:(e==null?void 0:e.values)||"values",children:(e==null?void 0:e.children)||"children"}}),{children:m,linkChildren:H}=F.useChildren(de);H();const T=X(()=>ye(t.itemHeight)),o=X(()=>{const e=t.columns[0];if(typeof e=="object"){if(c.value.children in e)return"cascade";if(c.value.values in e)return"object"}return"plain"}),w=()=>{var e;const a=[];let s={[c.value.children]:t.columns};for(;s&&s[c.value.children];){const C=s[c.value.children];let I=(e=s.defaultIndex)!=null?e:+t.defaultIndex;for(;C[I]&&C[I].disabled;)if(I<C.length-1)I++;else{I=0;break}a.push({[c.value.values]:s[c.value.children],className:s.className,defaultIndex:I}),s=C[I]}g.value=a},O=()=>{const{columns:e}=t;o.value==="plain"?g.value=[{[c.value.values]:e}]:o.value==="cascade"?w():g.value=e,h.value=g.value.some(a=>a[c.value.values]&&a[c.value.values].length!==0)||m.some(a=>a.hasOptions)},N=()=>m.map(e=>e.state.index),D=(e,a)=>{const s=m[e];s&&(s.setOptions(a),h.value=!0)},f=e=>{let a={[c.value.children]:t.columns};const s=N();for(let C=0;C<=e;C++)a=a[c.value.children][s[C]];for(;a&&a[c.value.children];)e++,D(e,a[c.value.children]),a=a[c.value.children][a.defaultIndex||0]},b=e=>m[e],k=e=>{const a=b(e);if(a)return a.getValue()},E=(e,a)=>{const s=b(e);s&&(s.setValue(a),o.value==="cascade"&&f(e))},P=e=>{const a=b(e);if(a)return a.state.index},_=(e,a)=>{const s=b(e);s&&(s.setIndex(a),o.value==="cascade"&&f(e))},B=e=>{const a=b(e);if(a)return a.state.options},M=()=>m.map(e=>e.getValue()),U=e=>{e.forEach((a,s)=>{E(s,a)})},V=e=>{e.forEach((a,s)=>{_(s,a)})},A=e=>{o.value==="plain"?r(e,k(0),P(0)):r(e,M(),N())},Y=e=>{o.value==="cascade"&&f(e),o.value==="plain"?r("change",k(0),P(0)):r("change",M(),e)},K=()=>{m.forEach(e=>e.stopMomentum()),A("confirm")},J=()=>A("cancel"),n=()=>{if(i.title)return i.title();if(t.title)return d("div",{class:[x("title"),"van-ellipsis"]},[t.title])},l=()=>{const e=t.cancelButtonText||oe("cancel");return d("button",{type:"button",class:[x("cancel"),te],onClick:J},[i.cancel?i.cancel():e])},u=()=>{const e=t.confirmButtonText||oe("confirm");return d("button",{type:"button",class:[x("confirm"),te],onClick:K},[i.confirm?i.confirm():e])},v=()=>{if(t.showToolbar){const e=i.toolbar||i.default;return d("div",{class:x("toolbar")},[e?e():[l(),n(),u()]])}},$=()=>g.value.map((e,a)=>{var s;return d(Pe,{textKey:c.value.text,readonly:t.readonly,allowHtml:t.allowHtml,className:e.className,itemHeight:T.value,defaultIndex:(s=e.defaultIndex)!=null?s:+t.defaultIndex,swipeDuration:t.swipeDuration,initialOptions:e[c.value.values],visibleItemCount:t.visibleItemCount,onChange:()=>Y(a)},{option:i.option})}),q=e=>{if(h.value){const a={height:"".concat(T.value,"px")},s={backgroundSize:"100% ".concat((e-T.value)/2,"px")};return[d("div",{class:x("mask"),style:s},null),d("div",{class:[Ie,x("frame")],style:a},null)]}},z=()=>{const e=T.value*+t.visibleItemCount,a={height:"".concat(e,"px")};return d("div",{ref:y,class:x("columns"),style:a},[$(),q(e)])};return W(()=>t.columns,O,{immediate:!0}),F.useEventListener("touchmove",ue,{target:y}),ce({confirm:K,getValues:M,setValues:U,getIndexes:N,setIndexes:V,getColumnIndex:P,setColumnIndex:_,getColumnValue:k,setColumnValue:E,getColumnValues:B,setColumnValues:D}),()=>{var e,a;return d("div",{class:x()},[t.toolbarPosition==="top"?v():null,t.loading?d(Te,{class:x("loading")},null):null,(e=i["columns-top"])==null?void 0:e.call(i),z(),(a=i["columns-bottom"])==null?void 0:a.call(i),t.toolbarPosition==="bottom"?v():null])}}});const De=we(Se);export{De as P,Ee as p};
