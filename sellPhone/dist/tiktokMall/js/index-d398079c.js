import{_ as F,j as U,v as L,a0 as j,l as A,r as i,q as E,i as R,m as z,o as g,c as x,b as f,w as C,a as o,t as r,u as t,x as N,d as _,n as w,T as h,cc as D,a9 as H,cb as M,F as O}from"./index-55507c28.js";import{B as P}from"./index-64f4bac7.js";import"./index-6e53b41f.js";import{F as G}from"./index-3bdff75a.js";import{a as J}from"./login.api-f8cfd6d7.js";import"./use-id-acc627d9.js";const K={class:"verify-content"},Q={class:"info-content"},W={class:"info-item"},X={class:"info-item"},Y={class:"gap"},Z={key:0},$={class:"submit-content"},ee={__name:"index",setup(te){const d=U(),{t:a}=L.useI18n(),y=j(),b=A(),n=i(1),V=i("44"),p=i(""),l=i(0),v=i(null),m=i(!1);n.value=y.query&&y.query.type?Number(y.query.type):1,E(()=>{clearInterval(v.value),v.value=null});const k=R(),B=z(()=>{if(!d.userInfo.token)b.push("/login");else{const{email:u,phone:e}=d.userInfo;let s="";if(n.value===1){if(e){const c=e.split(" ");c.length===2?(V.value=c[0],s=c[1]):s=c[0]}}else s=u||"";return s}}),S=()=>{if(l.value>0)return!1;const{email:u,phone:e}=d.userInfo;h.loading({duration:0,forbidClick:!0}),console.log(n.value);debugger;J({target:n.value===1?e:u}).then(()=>{h(a("sendSuccess")),l.value=60,v.value=setInterval(()=>{l.value>0?l.value=l.value-1:(l.value=0,clearInterval(v.value),v.value=null)},1e3)}).catch(()=>{h.clear()})},T=async()=>{if(p.value===""){h(a("entryVerifyCode"));return}m.value=!0;const{email:u,phone:e}=d.userInfo,s={target:n.value===1?e:u,verifcode:p.value};n.value===1?s.phone=e:s.email=u,D(s).then(async c=>{await d.getUserInfo(!0),m.value=!1,b.back()}).catch(()=>{m.value=!1})};return(u,e)=>{const s=H,c=G,I=P;return g(),x("div",K,[f(s,{fixed:!0},{title:C(()=>[_(r(n.value===1?t(a)("手机验证"):t(a)("邮箱验证")),1)]),_:1}),e[1]||(e[1]=o("div",{style:{height:"46px"}},null,-1)),o("div",Q,[o("div",W,[o("p",null,r(t(a)("为了保障您的账号安全，请验证后进行下一步操作")),1)]),o("div",X,[o("p",Y,r(n.value===1?t(a)("当前绑定手机号"):t(a)("当前绑定邮箱")),1),o("h2",null,[n.value===1?(g(),x("span",Z,"(+"+r(V.value)+")",1)):N("",!0),_(r(t(M)(B.value,!1)),1)])]),o("div",{class:w(["code-content",{"is-ar":t(k)}])},[f(c,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=q=>p.value=q),type:"tel",label:"",placeholder:t(a)("entryVerifyCode")},null,8,["modelValue","placeholder"]),o("div",{class:w(["btn",{"is-ar":t(k)}])},[f(I,{type:"primary",onClick:S},{default:C(()=>[_(r(t(a)("sendVerifyCode")),1),l.value?(g(),x(O,{key:0},[_("("+r(l.value)+")s",1)],64)):N("",!0)]),_:1})],2)],2)]),o("div",$,[f(I,{type:"primary",loading:m.value,onClick:T},{default:C(()=>[_(r(t(a)("confirm")),1)]),_:1},8,["loading"])])])}}},ue=F(ee,[["__scopeId","data-v-8d5ae928"]]);export{ue as default};
