import{_ as me,i as pe,j as ve,l as he,a0 as ge,v as fe,r as u,f as _e,q as be,T as i,m as U,s as ye,o as g,c as f,b as m,w as _,u as o,x,a as d,t as c,d as C,b6 as ke,M as xe,a9 as Ce,ap as we,n as Pe}from"./index-55507c28.js";import{P as Ve}from"./index-3c69927a.js";import"./index-6e53b41f.js";import{F as Te}from"./index-3bdff75a.js";import"./index-912b17af.js";/* empty css              *//* empty css              */import{U as Re}from"./index-6a5a78c7.js";import{B as Ue}from"./index-64f4bac7.js";import{b as Ae}from"./browser-8e768ced.js";import{E as Be,i as Ne}from"./index-dfae592b.js";import{c as Se,t as K,i as Ie,j as qe,k as De,l as je}from"./exchange.api-6b2f1fdd.js";import{u as Ee}from"./upload.api-93555138.js";import{E as I}from"./index-5f89f735.js";import{u as Ge}from"./index-76527f4c.js";import"./use-id-acc627d9.js";import"./index-dc8f9730.js";import"./index-715fcdb8.js";const He={key:0,class:"rechargeDetail"},Le=["src"],Fe={class:"download"},Me={class:"my-uploader"},$e={key:1,class:"rechargeDetail bank-input-content"},ze={key:0,class:"icon-type-content"},Oe={class:"mb-2.5 text-xs",style:{color:"#333"}},Qe={key:1,class:"recharge-limit"},We={key:2,class:"recharge-limit"},Ke={key:2,class:"pay-button"},Je={class:"pay-button-content"},Xe={class:"pay-button-title"},Ye={__name:"detail",setup(Ze){const J=pe(),A=ve(),q=he(),w=ge(),{t}=fe.useI18n();u(1e9);const P=u(""),V=u(""),X=u(""),p=u(""),D=u(""),B=u(""),N=u(""),b=u(!1),j=u([]),O=u([]),E=u(""),{toClipboard:Y}=Ge(),G=a=>[null,void 0,""].includes(a),Z=async a=>{B.value=await Ae.toDataURL(a)};_e(P,a=>{var r,v;const l=j.value.find(h=>h.blockchain_name===a),n=(r=l==null?void 0:l.address)!=null?r:"";n&&(V.value=n,D.value=(v=l==null?void 0:l.fee)!=null?v:"",Z(n))},{deep:!0});const y=u(!1),H=u(50),L=u(3e4),ee=()=>{const a=w.params.id;if(S.value=a,a)if(i.loading({duration:0,forbidClick:!0}),a!=="bank")Se().then(e=>{const n=e.filter(r=>r.coin===a.toUpperCase()).map(r=>({...r,label:r.blockchain_name,value:r.blockchain_name}));n.length&&(P.value=n[0].value),j.value=n!=null?n:[]});else{const{g:e,key:l}=w.query;y.value=!!e,e?K().then(n=>{const r=n.find(v=>v.productType===l);r&&(H.value=r.range[0].min_amount,L.value=r.range[0].max_amount)}):K().then(n=>{const r=n.find(v=>v.productType==="Bank");$.value=r.range||[]})}else i(t("参数错误")),setTimeout(()=>{q.back()},1500)};be(async()=>{await ae(),await ee(),i.clear()});const ae=()=>{const a=Number(A.userInfo.kyc_status);let e="";switch(a){case 0:e="未认证";break;case 1:e="审核中";break;case 3:e="审核失败";break}a!==2&&(i(t(e)),setTimeout(()=>{q.back()},1500))},Q=U(()=>{var l;const a=p.value,e=(l=D.value)!=null?l:1;return Ne.times(a,e)});U(()=>{const a=X.value;return String(a).length<6});const te=U(()=>{const a=D.value;return"1:".concat(a)}),W=()=>{q.push({name:"RechargeRecord"})},oe=()=>{ke(B.value,"QRCode")},ne=a=>{i(t("fileMaxLimit"))},le=a=>{a.status="uploading",a.message=t("uploading"),Ee({file:a.file,moduleName:"recharge"}).then(e=>{a.status="success",a.message=t("uploadSuccess"),E.value=e}).catch(()=>{a.message=t("上传失败"),a.status="failed"})},se=async()=>{try{await Y(V.value),i(t("copySuccess"))}catch(a){console.error(a)}},F=u(""),M=()=>new Promise((a,e)=>{var l;qe({session_token:(l=A==null?void 0:A.userInfo)==null?void 0:l.token}).then(n=>{F.value=n.session_token,a()}).catch(()=>{e()})}),ue=async()=>{var e;if(G(P.value)){i(t("blockchainNetworkRequire"));return}if(G(p.value)){i(t("rechargeAmountRequire"));return}if(G(E.value)){i(t("uploadPaymentImageRequire"));return}const a={session_token:F.value,from:"123",blockchain_name:P.value,channel_address:V.value,amount:p.value,img:E.value,coin:((e=w.params.id)!=null?e:"").toUpperCase(),tx:""};b.value=!0,M().then(()=>{Ie(a).then(l=>{i(t("rechargeApplySuccess")),setTimeout(()=>{W()},1500)}).finally(()=>{b.value=!1})})},S=u(""),$=u([]),T=u(!1),k=u(""),re=U(()=>$.value.map(a=>({text:a.bank_code,value:a.bank_code}))),R=U(()=>{const a=$.value.find(e=>e.bank_code===k.value);return a||null}),ce=({value:a})=>{k.value=a,T.value=!1},ie=a=>{N.value="",xe(a,!0)},de=()=>{if(!k.value&&!y.value){i(t("请选择充值币种"));return}if(!p.value){i(t("请输入充值金额"));return}const a=Number(p.value);if(isNaN(a))i(t("请输入充值金额"));else{const e=y.value?H.value:R.value.min_amount,l=y.value?L.value:R.value.max_amount;if(a<e){i(t("充值金额不得低于最小限额"));return}if(a>l){i(t("充值金额不得高于最大限额"));return}const{g:n}=w.query;b.value=!0,M().then(async()=>{const{key:r}=w.query,v={session_token:F.value,amount:p.value,pageUrl:r==="gcash"?null:window.location.href+"/www/#/my"};let h="PHP_recharge";switch(r){case"GCash pay":h="PHP_recharge5";break;case"gcash":h="PHP_recharge";break;case"GCash2.0":h="PHP_recharge2";break;case"GCash3.0":h="PHP_recharge3";break;case"Maya":h="PHP_recharge4";break}const z=n?De:je;n||(v.frenchCurrency=k.value),await z(v,h).then(s=>{p.value="",b.value=!1,N.value=s}).catch(()=>{b.value=!1})})}};return ye(()=>{M()}),(a,e)=>{const l=Ce,n=Ue,r=Re,v=Te,h=Ve,z=we;return g(),f("div",null,[m(l,{fixed:""},{title:_(()=>[d("div",null,c(o(t)("recharge")),1)]),right:_(()=>[d("div",{onClick:W},c(o(t)("rechargeRecord")),1)]),_:1}),S.value&&S.value!=="bank"?(g(),f("div",He,[m(Be,{list:j.value,label:o(t)("blockchainNetwork"),modelValue:P.value,"onUpdate:modelValue":e[0]||(e[0]=s=>P.value=s)},null,8,["list","label","modelValue"]),B.value?(g(),f("img",{key:0,class:"qrCode",src:B.value,alt:""},null,8,Le)):x("",!0),d("div",Fe,[m(n,{type:"default",onClick:oe},{default:_(()=>[C(c(o(t)("saveQrCode")),1)]),_:1})]),m(I,{label:o(t)("rechargeAddress"),modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=s=>V.value=s),"clear-btn":!1,readonly:"",typeText:"text"},{rightBtn:_(()=>[d("div",{class:Pe(["rechargeDetail-all",{"is-ar":o(J)}]),onClick:se},c(o(t)("copy")),3)]),_:1},8,["label","modelValue"]),m(I,{label:o(t)("rechargeAmount"),placeholderText:o(t)("rechargeAmountTips"),modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=s=>p.value=s),typeText:"number"},null,8,["label","placeholderText","modelValue"]),m(I,{label:o(t)("expectedAmount",{ratio:te.value}),modelValue:Q.value,"onUpdate:modelValue":e[3]||(e[3]=s=>Q.value=s),maxLength:18,clearBtn:!1,readonly:"",typeText:"number"},{rightBtn:_(()=>[...e[11]||(e[11]=[d("div",{class:"rechargeDetail-unit"},c("USDT"),-1)])]),_:1},8,["label","modelValue"]),d("div",Me,[d("div",null,c(o(t)("uploadPaymentImage")),1),m(r,{modelValue:O.value,"onUpdate:modelValue":e[4]||(e[4]=s=>O.value=s),"max-size":1e4*1024,onOversize:ne,"after-read":le,"max-count":1},null,8,["modelValue"])]),m(n,{class:"w-full btn-content",type:"primary",loading:b.value,onClick:ue},{default:_(()=>[C(c(o(t)("submit")),1)]),_:1},8,["loading"])])):x("",!0),S.value==="bank"?(g(),f("div",$e,[y.value?x("",!0):(g(),f("div",ze,[d("div",Oe,c(o(t)("选择币种")),1),m(v,{modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=s=>k.value=s),readonly:"",name:"picker",placeholder:o(t)("请选择充值币种"),onClick:e[6]||(e[6]=s=>T.value=!0)},null,8,["modelValue","placeholder"]),m(z,{show:T.value,"onUpdate:show":e[8]||(e[8]=s=>T.value=s),position:"bottom"},{default:_(()=>[m(h,{columns:re.value,"cancel-button-text":o(t)("cancel"),"confirm-button-text":o(t)("confirm"),onConfirm:ce,onCancel:e[7]||(e[7]=s=>T.value=!1)},null,8,["columns","cancel-button-text","confirm-button-text"])]),_:1},8,["show"])])),m(I,{label:o(t)("充值金额"),placeholderText:o(t)("请输入充值金额"),modelValue:p.value,"onUpdate:modelValue":e[9]||(e[9]=s=>p.value=s),typeText:"number"},null,8,["label","placeholderText","modelValue"]),k.value&&R.value&&!y.value?(g(),f("div",Qe,[C(c(o(t)("充值限额"))+"：",1),d("span",null,c(R.value.min_amount),1),e[12]||(e[12]=C(" ~ ",-1)),d("span",null,c(R.value.max_amount),1)])):x("",!0),y.value?(g(),f("div",We,[C(c(o(t)("充值限额"))+"：",1),d("span",null,c(H.value),1),e[13]||(e[13]=C(" ~ ",-1)),d("span",null,c(L.value),1)])):x("",!0),m(n,{class:"w-full btn-content gap",type:"primary",loading:b.value,onClick:de},{default:_(()=>[C(c(o(t)("submit")),1)]),_:1},8,["loading"])])):x("",!0),N.value?(g(),f("div",Ke,[d("div",Je,[d("span",Xe,c(o(t)("请前往{_$1}继续完成支付",{_$1:o(w).query.key})),1),d("div",{class:"pay-button-button",onClick:e[10]||(e[10]=s=>ie(N.value))},c(o(t)("继续支付")),1)])])):x("",!0)])}}},_a=me(Ye,[["__scopeId","data-v-b47e76a2"]]);export{_a as default};
