import{aq as te,e as ne,ar as Ye,b as d,as as Fe,at as se,X as He,au as Ue,av as Te,aw as ae,ax as X,r as C,m as j,q as me,s as U,f as B,ay as de,az as ve,aA as fe,aB as E,aC as ce,aD as Ee,aE as ie,_ as je,j as ze,i as Re,v as Ge,a0 as Le,l as qe,aF as Q,p as Je,Z as S,o as Z,c as W,w as I,a as x,n as Ke,u as J,a9 as Ze,t as w,x as ee,d as ue,y as Ae,J as Xe,T as V,M as Qe,I as We,ap as et}from"./index-55507c28.js";import{B as tt}from"./index-64f4bac7.js";import{p as De,P as $e}from"./index-3c69927a.js";import{C as nt}from"./index-ae8bb03f.js";import"./index-6e53b41f.js";import{F as at}from"./index-3bdff75a.js";import{s as lt,a as ot,b as st}from"./product.api-71b8732b.js";import{F as it}from"./index-316b036f.js";import{D as Ve}from"./function-call-cafb329d.js";import"./use-id-acc627d9.js";import"./index-260e30ee.js";import"./___vite-browser-external_commonjs-proxy-685e0cd7.js";const[ut,re]=te("switch"),rt={size:Fe,loading:Boolean,disabled:Boolean,modelValue:se,activeColor:String,inactiveColor:String,activeValue:{type:se,default:!0},inactiveValue:{type:se,default:!1}};var ct=ne({name:ut,props:rt,emits:["change","update:modelValue"],setup(t,{emit:v,slots:k}){const p=()=>t.modelValue===t.activeValue,f=()=>{if(!t.disabled&&!t.loading){const o=p()?t.inactiveValue:t.activeValue;v("update:modelValue",o),v("change",o)}},m=()=>{if(t.loading){const o=p()?t.activeColor:t.inactiveColor;return d(He,{class:re("loading"),color:o},null)}if(k.node)return k.node()};return Ye.useCustomFieldValue(()=>t.modelValue),()=>{var o;const{size:R,loading:N,disabled:i,activeColor:O,inactiveColor:e}=t,z=p(),Y={fontSize:Ue(R),backgroundColor:z?O:e};return d("div",{role:"switch",class:re({on:z,loading:N,disabled:i}),style:Y,tabindex:i?void 0:0,"aria-checked":z,onClick:f},[d("div",{class:re("node")},[m()]),(o=k.background)==null?void 0:o.call(k)])}}});const mt=Te(ct),_e=ae({},De,{filter:Function,columnsOrder:Array,formatter:{type:Function,default:(t,v)=>v}}),Se=Object.keys(De);function we(t,v){if(t<0)return[];const k=Array(t);let p=-1;for(;++p<t;)k[p]=v(p);return k}function dt(t){if(!t)return 0;for(;Number.isNaN(parseInt(t,10));)if(t.length>1)t=t.slice(1);else return 0;return parseInt(t,10)}const Ce=(t,v)=>32-new Date(t,v-1,32).getDate(),Me=(t,v)=>{const k=["setValues","setIndexes","setColumnIndex","setColumnValue"];return new Proxy(t,{get:(p,f)=>k.includes(f)?(...m)=>{p[f](...m),v()}:p[f]})},[vt]=te("time-picker");var pe=ne({name:vt,props:ae({},_e,{minHour:X(0),maxHour:X(23),minMinute:X(0),maxMinute:X(59),modelValue:String}),emits:["confirm","cancel","change","update:modelValue"],setup(t,{emit:v,slots:k}){const p=r=>{const{minHour:l,maxHour:s,maxMinute:u,minMinute:g}=t;r||(r="".concat(E(l),":").concat(E(g)));let[h,b]=r.split(":");return h=E(ce(+h,+l,+s)),b=E(ce(+b,+g,+u)),"".concat(h,":").concat(b)},f=C(),m=C(p(t.modelValue)),o=j(()=>[{type:"hour",range:[+t.minHour,+t.maxHour]},{type:"minute",range:[+t.minMinute,+t.maxMinute]}]),R=j(()=>o.value.map(({type:r,range:l})=>{let s=we(l[1]-l[0]+1,u=>E(l[0]+u));return t.filter&&(s=t.filter(r,s)),{type:r,values:s}})),N=j(()=>R.value.map(r=>({values:r.values.map(l=>t.formatter(r.type,l))}))),i=()=>{const r=m.value.split(":"),l=[t.formatter("hour",r[0]),t.formatter("minute",r[1])];U(()=>{var s;(s=f.value)==null||s.setValues(l)})},O=()=>{const[r,l]=f.value.getIndexes(),[s,u]=R.value,g=s.values[r]||s.values[0],h=u.values[l]||u.values[0];m.value=p("".concat(g,":").concat(h)),i()},e=()=>v("confirm",m.value),z=()=>v("cancel"),Y=()=>{O(),U(()=>{U(()=>v("change",m.value))})};return me(()=>{i(),U(O)}),B(N,i),B(()=>[t.filter,t.maxHour,t.minMinute,t.maxMinute],O),B(()=>t.minHour,()=>{U(O)}),B(m,r=>v("update:modelValue",r)),B(()=>t.modelValue,r=>{r=p(r),r!==m.value&&(m.value=r,i())}),de({getPicker:()=>f.value&&Me(f.value,O)}),()=>d($e,ve({ref:f,columns:N.value,onChange:Y,onCancel:z,onConfirm:e},fe(t,Se)),k)}});const Pe=new Date().getFullYear(),[ft]=te("date-picker");var ge=ne({name:ft,props:ae({},_e,{type:Ee("datetime"),modelValue:Date,minDate:{type:Date,default:()=>new Date(Pe-10,0,1),validator:ie},maxDate:{type:Date,default:()=>new Date(Pe+10,11,31),validator:ie}}),emits:["confirm","cancel","change","update:modelValue"],setup(t,{emit:v,slots:k}){const p=l=>{if(ie(l)){const s=ce(l.getTime(),t.minDate.getTime(),t.maxDate.getTime());return new Date(s)}},f=C(),m=C(p(t.modelValue)),o=(l,s)=>{const u=t["".concat(l,"Date")],g=u.getFullYear();let h=1,b=1,F=0,M=0;return l==="max"&&(h=12,b=Ce(s.getFullYear(),s.getMonth()+1),F=23,M=59),s.getFullYear()===g&&(h=u.getMonth()+1,s.getMonth()+1===h&&(b=u.getDate(),s.getDate()===b&&(F=u.getHours(),s.getHours()===F&&(M=u.getMinutes())))),{["".concat(l,"Year")]:g,["".concat(l,"Month")]:h,["".concat(l,"Date")]:b,["".concat(l,"Hour")]:F,["".concat(l,"Minute")]:M}},R=j(()=>{const{maxYear:l,maxDate:s,maxMonth:u,maxHour:g,maxMinute:h}=o("max",m.value||t.minDate),{minYear:b,minDate:F,minMonth:M,minHour:K,minMinute:y}=o("min",m.value||t.minDate);let T=[{type:"year",range:[b,l]},{type:"month",range:[M,u]},{type:"day",range:[F,s]},{type:"hour",range:[K,g]},{type:"minute",range:[y,h]}];switch(t.type){case"date":T=T.slice(0,3);break;case"year-month":T=T.slice(0,2);break;case"month-day":T=T.slice(1,3);break;case"datehour":T=T.slice(0,4);break}if(t.columnsOrder){const G=t.columnsOrder.concat(T.map(H=>H.type));T.sort((H,L)=>G.indexOf(H.type)-G.indexOf(L.type))}return T}),N=j(()=>R.value.map(({type:l,range:s})=>{let u=we(s[1]-s[0]+1,g=>E(s[0]+g));return t.filter&&(u=t.filter(l,u)),{type:l,values:u}})),i=j(()=>N.value.map(l=>({values:l.values.map(s=>t.formatter(l.type,s))}))),O=()=>{const l=m.value||t.minDate,{formatter:s}=t,u=N.value.map(g=>{switch(g.type){case"year":return s("year","".concat(l.getFullYear()));case"month":return s("month",E(l.getMonth()+1));case"day":return s("day",E(l.getDate()));case"hour":return s("hour",E(l.getHours()));case"minute":return s("minute",E(l.getMinutes()));default:return""}});U(()=>{var g;(g=f.value)==null||g.setValues(u)})},e=()=>{const{type:l}=t,s=f.value.getIndexes(),u=T=>{let G=0;N.value.forEach((L,A)=>{T===L.type&&(G=A)});const{values:H}=N.value[G];return dt(H[s[G]])};let g,h,b;l==="month-day"?(g=(m.value||t.minDate).getFullYear(),h=u("month"),b=u("day")):(g=u("year"),h=u("month"),b=l==="year-month"?1:u("day"));const F=Ce(g,h);b=b>F?F:b;let M=0,K=0;l==="datehour"&&(M=u("hour")),l==="datetime"&&(M=u("hour"),K=u("minute"));const y=new Date(g,h-1,b,M,K);m.value=p(y)},z=()=>{v("update:modelValue",m.value),v("confirm",m.value)},Y=()=>v("cancel"),r=()=>{e(),U(()=>{e(),U(()=>v("change",m.value))})};return me(()=>{O(),U(e)}),B(i,O),B(m,(l,s)=>v("update:modelValue",s?l:null)),B(()=>[t.filter,t.minDate,t.maxDate],()=>{U(e)}),B(()=>t.modelValue,l=>{var s;l=p(l),l&&l.valueOf()!==((s=m.value)==null?void 0:s.valueOf())&&(m.value=l)}),de({getPicker:()=>f.value&&Me(f.value,e)}),()=>d($e,ve({ref:f,columns:i.value,onChange:r,onCancel:Y,onConfirm:z},fe(t,Se)),k)}});const[pt,gt]=te("datetime-picker"),bt=Object.keys(pe.props),ht=Object.keys(ge.props),yt=ae({},pe.props,ge.props,{modelValue:[String,Date]});var kt=ne({name:pt,props:yt,setup(t,{attrs:v,slots:k}){const p=C();return de({getPicker:()=>{var f;return(f=p.value)==null?void 0:f.getPicker()}}),()=>{const f=t.type==="time",m=f?pe:ge,o=fe(t,f?bt:ht);return d(m,ve({ref:p,class:gt()},o,v),k)}}});const xt=Te(kt);const Vt={class:"editProduct"},Ct={class:"tip pt-2 pb-2 pl-4 pr-4"},Pt={class:"profit"},Tt={key:0,class:"flex pl-4 pr-4 input-item pt-3 pb-3"},Dt={class:"flex"},$t={class:"flex pl-4 pr-4 input-item pt-3 pb-3"},_t={class:"flex"},St={class:"tip pt-2 pb-2 pl-4 pr-4"},wt={class:"tips pt-2 pb-2 pl-4 pr-4"},Mt={class:"tip pt-2 pb-2 pl-4 pr-4"},It={class:"tip pt-2 pb-2 pl-4 pr-4"},Nt={class:"tip pt-2 pb-2 pl-4 pr-4"},Ot={style:{margin:"16px"},class:"pb-8"},Bt={__name:"productEdit",setup(t){const v="tiktokMall",k=ze(),p=j(()=>{}),f=j(()=>{}),m=Re(),{t:o}=Ge.useI18n(),R=Le(),N=qe(),i=C(JSON.parse(R.query.item)),O=C(new Date),e=C({sellingPrice:"",isShelf:0,recTime:0,isCombo:!1,startTime:Q(),endTime:Q(),discount:"",percent:"",profit:"",id:""}),z=()=>{Ve.confirm({title:o("product.21"),message:o("product.22"),confirmButtonText:o("sure"),cancelButtonText:o("cancel")}).then(()=>{ot({sellerGoodsId:e.value.id}).then(()=>{sessionStorage.setItem("currentProductId",i.value.id),sessionStorage.setItem("productDelete",!0),V(o("product.10")),N.go(-1)})}).catch(()=>{})},Y=C(!1),r=C(!1),l=C(!1),s=C(""),u=C(""),g=C(""),h=j(()=>{let n={};return k.userInfo.token?n={...k.userInfo}:N.push("/login"),n});me(()=>{T()}),B(()=>e.value.percent,(n,a)=>{}),B(()=>e.value.isCombo,(n,a)=>{n&&(console.log("开关打开"),F())}),B(()=>e.value.isShelf,(n,a)=>{console.log("开关打开",n),n/1===1&&K()});const b=C(!1),F=()=>{b.value=!0,L()},M=C(!1),K=()=>{M.value=!0,L()},y=Je({min:"",max:""}),T=()=>{e.value.id=i.value.id,e.value.discountPrice=i.value.discountPrice?S(i.value.discountPrice/1,2,!0):S(i.value.sellingPrice/1,2,!0),e.value.sellingPrice=S(i.value.sellingPrice/1,2,!0),e.value.isShelf=i.value.isShelf/1,e.value.isCombo=!!(i.value.isCombo/1),e.value.recTime=i.value.recTime/1,e.value.startTime=i.value.discountStartTime?i.value.discountStartTime.split(" ")[0]:i.value.discountStartTime,e.value.endTime=i.value.discountEndTime?i.value.discountEndTime.split(" ")[0]:i.value.discountEndTime,e.value.profit=S(i.value.profitRatio*100,2,!0),e.value.discount=S(i.value.discountRatio*100,2,!0),e.value.systemPrice=S(i.value.systemPrice/1,2,!0),e.value.percent=S(i.value.profitRatio/1*100,2,!0),y.min=Number(i.value.sysParaMin),y.max=Number(i.value.sysParaMax),lt().then(n=>{y.min=Number(n.sysParaMin),y.max=Number(n.sysParaMax)})},G=()=>{if([].includes(v))if(h.value.phoneverif&&h.value.emailverif)L();else{const n=h.value.phoneverif?"bindEmailTips":"请绑定手机号";Ve.confirm({title:o("dialogTips"),message:o(n),cancelButtonText:o("cancel"),confirmButtonText:o("gotoSet"),confirmButtonColor:"#1552F0",cancelButtonColor:"#999"}).then(()=>{Qe("/personalInfo")}).catch(()=>{console.log("cancel")})}else L()},H=C(!1),L=()=>{const{startTime:n,endTime:a,discount:D}=e.value;if(n||a){const P=new Date(n.replace(/-/g,"/")+" 00:00:00").getTime(),$=new Date(a.replace(/-/g,"/")+" 00:00:00").getTime();if(!D){V(o("请设置折扣比例"));return}if(P>$){V(o("开始时间应小于结束时间"));return}}if(Number(D)&&(!n||!a)){V(o("请正确填写活动开启时间和结束时间"));return}if(!ye()){H.value||(H.value=!0,V.loading({forbidClick:!0,loadingType:"spinner",duration:0}));let P={isShelf:e.value.isShelf?1:0,recTime:e.value.recTime?1:0,isCombo:e.value.isCombo?1:0,sellerGoodsId:i.value.id,startTime:e.value.startTime?e.value.startTime+" 00:00:00":"",endTime:e.value.endTime?e.value.endTime+" 00:00:00":"",discount:S(e.value.discount/100,2,!0),percent:S(e.value.percent/100,2,!0),profit:S(e.value.percent/100,2,!0)};return st(P).then($=>{V.clear(),H.value=!1,sessionStorage.setItem("currentProductId",i.value.id),b.value?b.value=!1:M.value?M.value=!1:(V(o("product.10")),N.push("/product"))}).catch($=>{H.value=!1;const _=$.msg;if(b.value=!1,M.value=!1,_.indexOf("未购买")>-1)V(o("您暂未购买直通车套餐，请购买再试"));else if(_.indexOf("已到期")>-1)V(o("您的直通车已到期"));else if(_.indexOf("最多推广")>-1){const q=_.split("最多推广商品数量为");V(o("最多推广商品数量为")+": "+q[1])}else if(_.indexOf("未激活")>-1)V(o("您的直通未激活"));else if(_.indexOf("未激活")>-1)V(o("您的直通未激活"));else if(_.indexOf("最小下架")>-1)V(o("少于店铺设置最小下架商品数"));else if(_.indexOf("首次上架")>-1){const q=typeof $.data=="string"?JSON.parse($.data):$.data;V(o(_,{_$1:q._$1}))}else V(o(_));e.value.isCombo=!1})}},A=n=>{switch(n){case 1:Y.value=!0;break;case 2:r.value=!0;break;case 3:l.value=!0;break}},be=n=>{switch(console.log(s.value),n){case 1:Y.value=!1,e.value.startTime=Q(s.value).format("YYYY-MM-DD");break;case 2:r.value=!1,e.value.endTime=Q(u.value).format("YYYY-MM-DD");break;case 3:l.value=!1,e.value.recTime=Ie(g.value);break}},he=n=>{switch(n){case 1:Y.value=!1;break;case 2:r.value=!1;break;case 3:l.value=!1;break}},Ie=n=>{let a=n.getFullYear(),D=n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1,P=n.getDate()<10?"0"+n.getDate():n.getDate(),$=n.getHours()<10?"0"+n.getHours():n.getHours(),_=n.getMinutes()<10?"0"+n.getMinutes():n.getMinutes(),q=n.getSeconds()<10?"0"+n.getSeconds():n.getSeconds();return a+"-"+D+"-"+P+" "+$+":"+_+":"+q},Ne=j(()=>{let n=0;if(!isNaN(e.value.sellingPrice)&&!isNaN(e.value.discount)){const a=Number(e.value.systemPrice),D=Number(S(Number(e.value.discount)/100,2,!0)),P=Number(e.value.sellingPrice)*(1-D);n=Number(P-a)}return S(n,2,!0)}),le=()=>{const n=Number(e.value.systemPrice),a=Number(S(Number(e.value.percent)/100,2,!0));e.value.sellingPrice=Number(S(n+n*a,2,!0))},ye=()=>{const n=Number(e.value.percent),a=Number(e.value.discount);let D=!1;if(!isNaN(n)){const P=/^\+?[1-9][0-9]*$/;if(!P.test(String(n)))return V(o("百分比必须为正整数")),!0;if(a&&!P.test(String(a)))return V(o("折扣比例必须为正整数")),!0;n>y.max&&(console.log("12"),e.value.percent=y.max,D=!0,le()),n<y.min&&(console.log("33"),e.value.percent=y.min,D=!0,le())}return D&&y.min&&y.max&&V(o("百分比设置范围为")+"：".concat(y.min,"% ~ ").concat(y.max,"%")),D},Oe=()=>{const n=Number(e.value.sellingPrice),a=Number(e.value.systemPrice),D=Number(S((n-a)/a*100,2,!0));e.value.percent=D};return(n,a)=>{const D=Ze,P=at,$=nt,_=mt,q=We,oe=xt,ke=et,xe=tt,Be=it;return Z(),W("div",Vt,[d(D,{fixed:""},{title:I(()=>[x("div",null,w(n.$t("编辑商品")),1)]),_:1}),x("div",{class:Ke(["edit-product-pop",{"is-ar":J(m)}])},[d(Be,null,{default:I(()=>[x("div",Ct,w(n.$t("当前售价")),1),d($,{class:"input-field",inset:""},{default:I(()=>[d(P,{modelValue:e.value.sellingPrice,"onUpdate:modelValue":a[0]||(a[0]=c=>e.value.sellingPrice=c),type:"number",placeholder:n.$t("当前售价"),onInput:Oe},{button:I(()=>[x("span",Pt,w(n.$t("利润"))+" "+w(Ne.value),1)]),_:1},8,["modelValue","placeholder"])]),_:1}),p.value?ee("",!0):(Z(),W("div",Tt,[x("div",null,w(n.$t("是否上架")),1),x("div",Dt,[d(_,{modelValue:e.value.isShelf,"onUpdate:modelValue":a[1]||(a[1]=c=>e.value.isShelf=c),size:"25","inactive-color":"#fff","inactive-value":0,"active-value":1},null,8,["modelValue"])])])),x("div",$t,[x("div",null,w(n.$t("是否推荐")),1),x("div",_t,[d(_,{modelValue:e.value.recTime,"onUpdate:modelValue":a[2]||(a[2]=c=>e.value.recTime=c),"inactive-value":0,"active-value":1,size:"25","inactive-color":"#fff"},null,8,["modelValue"])])]),x("div",St,w(n.$t("百分比")),1),d($,{class:"input-field",inset:""},{default:I(()=>[d(P,{modelValue:e.value.percent,"onUpdate:modelValue":a[3]||(a[3]=c=>e.value.percent=c),type:"number",placeholder:J(o)("百分比"),rules:[{required:!0,message:J(o)("请填写百分比"),max:y.max,min:y.min}],onInput:le,onBlur:ye},{button:I(()=>[...a[19]||(a[19]=[x("span",null,"%",-1)])]),_:1},8,["modelValue","placeholder","rules"])]),_:1}),x("div",wt,[ue(w(n.$t("将选中的商品发布到你的店铺，并填写商品利润比例，推荐比例"))+": ",1),x("span",null,w(y.min)+"%-"+w(y.max)+"% ",1)]),x("div",Mt,w(n.$t("折扣开始日期")),1),d($,{class:"input-field",inset:"",style:{position:"relative"}},{default:I(()=>[e.value.startTime?(Z(),W("div",{key:0,class:"time-clear",onClick:a[4]||(a[4]=c=>e.value.startTime="")},[d(q,{name:"cross"})])):ee("",!0),d(P,{onClickInput:a[5]||(a[5]=c=>A(1)),modelValue:e.value.startTime,"onUpdate:modelValue":a[6]||(a[6]=c=>e.value.startTime=c),placeholder:J(o)("折扣开始日期")},null,8,["modelValue","placeholder"]),d(ke,{show:Y.value,"onUpdate:show":a[10]||(a[10]=c=>Y.value=c),round:"",position:"bottom"},{default:I(()=>[d(oe,{"min-date":O.value,"confirm-button-text":n.$t("确定"),"cancel-button-text":n.$t("取消"),modelValue:s.value,"onUpdate:modelValue":a[7]||(a[7]=c=>s.value=c),type:"date",title:J(o)("选择完整时间"),onConfirm:a[8]||(a[8]=c=>be(1)),onCancel:a[9]||(a[9]=c=>he(1))},null,8,["min-date","confirm-button-text","cancel-button-text","modelValue","title"])]),_:1},8,["show"])]),_:1}),x("div",It,w(n.$t("折扣结束日期")),1),d($,{class:"input-field",inset:"",style:{position:"relative"}},{default:I(()=>[e.value.endTime?(Z(),W("div",{key:0,class:"time-clear",onClick:a[11]||(a[11]=c=>e.value.endTime="")},[d(q,{name:"cross"})])):ee("",!0),d(P,{onClickInput:a[12]||(a[12]=c=>A(2)),modelValue:e.value.endTime,"onUpdate:modelValue":a[13]||(a[13]=c=>e.value.endTime=c),placeholder:J(o)("折扣结束日期")},null,8,["modelValue","placeholder"])]),_:1}),x("div",Nt,w(n.$t("折扣比例")),1),d($,{class:"input-field",inset:""},{default:I(()=>[d(P,{modelValue:e.value.discount,"onUpdate:modelValue":a[14]||(a[14]=c=>e.value.discount=c),type:"number",placeholder:J(o)("折扣比例")},{button:I(()=>[...a[20]||(a[20]=[x("span",null,"%",-1)])]),_:1},8,["modelValue","placeholder"])]),_:1}),d(ke,{show:r.value,"onUpdate:show":a[18]||(a[18]=c=>r.value=c),round:"",position:"bottom"},{default:I(()=>[d(oe,{"min-date":O.value,"cancel-button-text":n.$t("取消"),"confirm-button-text":n.$t("确定"),modelValue:u.value,"onUpdate:modelValue":a[15]||(a[15]=c=>u.value=c),type:"date",title:J(o)("选择完整时间"),onConfirm:a[16]||(a[16]=c=>be(2)),onCancel:a[17]||(a[17]=c=>he(2))},null,8,["min-date","cancel-button-text","confirm-button-text","modelValue","title"])]),_:1},8,["show"]),x("div",Ot,[d(xe,{class:"btn-content",block:"",type:"primary",onClick:G,"native-type":"submit"},{default:I(()=>[ue(w(n.$t("保存")),1)]),_:1}),f.value?ee("",!0):(Z(),Ae(xe,{key:0,style:{"margin-top":"16px","background-color":"red","border-radius":"4px","border-color":"red"},block:"",type:"primary",onClick:Xe(z,["stop"]),"native-type":"submit"},{default:I(()=>[ue(w(n.$t("删除")),1)]),_:1}))])]),_:1})],2)])}}},Kt=je(Bt,[["__scopeId","data-v-75d8ca57"]]);export{Kt as default};
