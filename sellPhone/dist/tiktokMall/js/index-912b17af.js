import{aq as B,e as O,b9 as Y,as as M,p as q,aI as oe,r as F,m as b,f as T,ar as L,b as r,aJ as N,aC as p,X as te,aG as z,ba as ae,ax as Z,at as k,aD as A,ay as se,q as ne,by as ie,bz as ce,s as le,az as j,aA as re,ap as me,bc as ue,I as ve,bP as de,bK as ge,aw as he,av as fe,b$ as we,c0 as xe}from"./index-55507c28.js";import{S as Pe,a as Ie}from"./index-dc8f9730.js";import{I as Ce}from"./index-715fcdb8.js";const _=o=>Math.sqrt((o[0].clientX-o[1].clientX)**2+(o[0].clientY-o[1].clientY)**2),E=B("image-preview")[1];var ye=O({props:{src:String,show:Boolean,active:Number,minZoom:Y(M),maxZoom:Y(M),rootWidth:Y(Number),rootHeight:Y(Number)},emits:["scale","close"],setup(o,{emit:c}){const e=q({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),l=oe(),i=F(),d=b(()=>{const{rootWidth:t,rootHeight:s}=o,n=s/t;return e.imageRatio>n}),R=b(()=>{const{scale:t,moveX:s,moveY:n,moving:v,zooming:C}=e,X={transitionDuration:C||v?"0s":".3s"};if(t!==1){const Q=s/t,ee=n/t;X.transform="scale(".concat(t,", ").concat(t,") translate(").concat(Q,"px, ").concat(ee,"px)")}return X}),g=b(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:s}=o,n=d.value?s/e.imageRatio:t;return Math.max(0,(e.scale*n-t)/2)}return 0}),h=b(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:s}=o,n=d.value?s:t*e.imageRatio;return Math.max(0,(e.scale*n-s)/2)}return 0}),f=t=>{t=p(t,+o.minZoom,+o.maxZoom+1),t!==e.scale&&(e.scale=t,c("scale",{scale:t,index:o.active}))},S=()=>{f(1),e.moveX=0,e.moveY=0},W=()=>{const t=e.scale>1?1:2;f(t),e.moveX=0,e.moveY=0};let w,x,P,I,a,m,u;const U=t=>{const{touches:s}=t,{offsetX:n}=l;l.start(t),w=s.length,x=e.moveX,P=e.moveY,u=Date.now(),e.moving=w===1&&e.scale!==1,e.zooming=w===2&&!n.value,e.zooming&&(I=e.scale,a=_(t.touches))},G=t=>{const{touches:s}=t;if(l.move(t),(e.moving||e.zooming)&&N(t,!0),e.moving){const{deltaX:n,deltaY:v}=l,C=n.value+x,X=v.value+P;e.moveX=p(C,-g.value,g.value),e.moveY=p(X,-h.value,h.value)}if(e.zooming&&s.length===2){const n=_(s),v=I*n/a;f(v)}},J=()=>{if(w>1)return;const{offsetX:t,offsetY:s}=l,n=Date.now()-u,v=250,C=5;t.value<C&&s.value<C&&n<v&&(m?(clearTimeout(m),m=null,W()):m=setTimeout(()=>{c("close"),m=null},v))},$=t=>{let s=!1;(e.moving||e.zooming)&&(s=!0,e.moving&&x===e.moveX&&P===e.moveY&&(s=!1),t.touches.length||(e.zooming&&(e.moveX=p(e.moveX,-g.value,g.value),e.moveY=p(e.moveY,-h.value,h.value),e.zooming=!1),e.moving=!1,x=0,P=0,I=1,e.scale<1&&S(),e.scale>o.maxZoom&&(e.scale=+o.maxZoom))),N(t,s),J(),l.reset()},V=t=>{const{naturalWidth:s,naturalHeight:n}=t.target;e.imageRatio=n/s};return T(()=>o.active,S),T(()=>o.show,t=>{t||S()}),L.useEventListener("touchmove",G,{target:b(()=>{var t;return(t=i.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>r(te,{type:"spinner"},null)};return r(Pe,{ref:i,class:E("swipe-item"),onTouchstartPassive:U,onTouchend:$,onTouchcancel:$},{default:()=>[r(Ce,{src:o.src,fit:"contain",class:E("image",{vertical:d.value}),style:R.value,onLoad:V},t)]})}}});const[Se,y]=B("image-preview"),be=["show","transition","overlayStyle","closeOnPopstate"],pe={show:Boolean,loop:z,images:ae(),minZoom:Z(1/3),maxZoom:Z(3),overlay:z,closeable:Boolean,showIndex:z,className:k,closeIcon:A("clear"),transition:String,beforeClose:Function,overlayClass:k,overlayStyle:Object,swipeDuration:Z(300),startPosition:Z(0),showIndicators:Boolean,closeOnPopstate:z,closeIconPosition:A("top-right")};var K=O({name:Se,props:pe,emits:["scale","close","closed","change","update:show"],setup(o,{emit:c,slots:e}){const l=F(),i=q({active:0,rootWidth:0,rootHeight:0}),d=()=>{if(l.value){const a=L.useRect(l.value.$el);i.rootWidth=a.width,i.rootHeight=a.height,l.value.resize()}},R=a=>c("scale",a),g=a=>c("update:show",a),h=()=>{de(o.beforeClose,{args:[i.active],done:()=>g(!1)})},f=a=>{a!==i.active&&(i.active=a,c("change",a))},S=()=>{if(o.showIndex)return r("div",{class:y("index")},[e.index?e.index({index:i.active}):"".concat(i.active+1," / ").concat(o.images.length)])},W=()=>{if(e.cover)return r("div",{class:y("cover")},[e.cover()])},w=()=>r(Ie,{ref:l,lazyRender:!0,loop:o.loop,class:y("swipe"),duration:o.swipeDuration,initialSwipe:o.startPosition,showIndicators:o.showIndicators,indicatorColor:"white",onChange:f},{default:()=>[o.images.map(a=>r(ye,{src:a,show:o.show,active:i.active,maxZoom:o.maxZoom,minZoom:o.minZoom,rootWidth:i.rootWidth,rootHeight:i.rootHeight,onScale:R,onClose:h},null))]}),x=()=>{if(o.closeable)return r(ve,{role:"button",name:o.closeIcon,class:[y("close-icon",o.closeIconPosition),ue],onClick:h},null)},P=()=>c("closed"),I=(a,m)=>{var u;return(u=l.value)==null?void 0:u.swipeTo(a,m)};return se({swipeTo:I}),ne(d),T([ie,ce],d),T(()=>o.startPosition,a=>f(+a)),T(()=>o.show,a=>{const{images:m,startPosition:u}=o;a?(f(+u),le(()=>{d(),I(+u,{immediate:!0})})):c("close",{index:i.active,url:m[i.active]})}),()=>r(me,j({class:[y(),o.className],overlayClass:[y("overlay"),o.overlayClass],onClosed:P,"onUpdate:show":g},re(o,be)),{default:()=>[x(),w(),S(),W()]})}});let H;const Te={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function Xe(){({instance:H}=we({setup(){const{state:o,toggle:c}=xe(),e=()=>{o.images=[]};return()=>r(K,j(o,{onClosed:e,"onUpdate:show":c}),null)}}))}const D=(o,c=0)=>{if(ge)return H||Xe(),o=Array.isArray(o)?{images:o,startPosition:c}:o,H.open(he({},Te,o)),H};D.Component=fe(K);D.install=o=>{o.use(D.Component)};export{D as I};
