import{_ as $,j as V,r,v as j,i as E,a0 as A,l as M,m as O,p as U,o as L,c as R,b as _,w as v,a as c,t as d,u as p,d as N,n as G,M as J,T as o,ap as q}from"./index-55507c28.js";import{B as z}from"./index-64f4bac7.js";import{C as H}from"./index-ae8bb03f.js";import"./index-6e53b41f.js";import{F as K}from"./index-3bdff75a.js";import{s as Q,e as W}from"./product.api-71b8732b.js";import{F as X}from"./index-316b036f.js";import{D as Y}from"./function-call-cafb329d.js";const Z={class:"edit-product-pop"},ee={class:"title"},te={class:"tip pt-2 pb-2 pl-4 pr-4"},se={class:"tips pt-2 pb-2 pl-4 pr-4"},oe={style:{margin:"16px"}},ae={__name:"editProfit",props:{isEdit:Boolean,productArry:Array},emits:["back","update"],setup(B,{emit:I}){const y=V();r("true");const{t:e}=j.useI18n(),P=E(),g=r(!1);r(!1),r(!1),r(!1),r(new Date),r(""),r(""),r("");const k=I;A();const S=M(),t=r({startTime:"",endTime:"",discount:"",percent:""}),x=O(()=>{let n={};return y.userInfo.token?n={...y.userInfo}:S.push("/login"),n}),w=n=>{const l="tiktokMall";if([].includes(l)&&(!x.value.phoneverif||!x.value.emailverif)){const u=x.value.phoneverif?"bindEmailTips":"请绑定手机号";Y.confirm({title:e("dialogTips"),message:e(u),cancelButtonText:e("cancel"),confirmButtonText:e("gotoSet"),confirmButtonColor:"#1552F0",cancelButtonColor:"#999"}).then(()=>{J("/personalInfo")}).catch(()=>{console.log("cancel")});return}const{startTime:m,endTime:f,discount:b}=t.value;if(m||f){const u=new Date(m.replace(/-/g,"/")+" 00:00:00").getTime(),s=new Date(f.replace(/-/g,"/")+" 00:00:00").getTime();if(!b){o(e("请设置折扣比例"));return}if(u>s){o(e("开始时间应小于结束时间"));return}}if(Number(b)&&(!m||!f)){o(e("请正确填写活动开启时间和结束时间"));return}let i={goodsIds:T.productArry.join(","),...t.value};if(t.value.percent>a.max||t.value.percent<a.min)o(e("百分比设置范围为")+"：".concat(a.min,"% ~ ").concat(a.max,"%"));else{const u=/^\+?[1-9][0-9]*$/;u.test(String(Number(t.value.percent)))?Number(t.value.discount)&&!u.test(String(Number(t.value.discount)))?o(e("折扣比例必须为正整数")):(g.value=!0,i.startTime=i.startTime+" 00:00:00",i.endTime=i.endTime+" 00:00:00",i.profit=(t.value.percent/100).toFixed(2),i.discount=(t.value.discount/100).toFixed(2),i.percent=(t.value.percent/100).toFixed(2),o.loading({forbidClick:!0}),W(i).then(()=>{o(e("上架成功")),F()}).catch(s=>{const h=typeof s.data=="string"?JSON.parse(s.data):s.data;if(h&&h._$1)o({message:e(s.msg,{_$1:h._$1}),duration:2e3});else if(s.msg.indexOf("：")>-1){const D=s.msg.split("：");o({message:e(D[0],{num:s.data.noLevelGoodsNum}),duration:2e3})}else o({message:e(s.msg),duration:2e3});g.value=!1})):o(e("百分比必须为正整数"))}},a=U({min:5,max:20});Q().then(n=>{a.min=Number(n.sysParaMin),a.max=Number(n.sysParaMax)});const F=()=>{C(),k("update")},T=B,C=()=>{k("close");for(const n in t.value)t.value[n]="";setTimeout(()=>{g.value=!1},500)};return(n,l)=>{const m=K,f=H,b=z,i=X,u=q;return L(),R("div",{class:G(["editProduct",{"is-ar":p(P)}])},[_(u,{show:T.isEdit,"onUpdate:show":l[1]||(l[1]=s=>T.isEdit=s),round:"",closeable:"",onClickCloseIcon:C,style:{height:"35%",width:"95%"}},{default:v(()=>[c("div",Z,[c("div",ee,d(p(e)("添加商品")),1),_(i,null,{default:v(()=>[c("div",te,d(p(e)("product.25")),1),_(f,{class:"input-field",inset:""},{default:v(()=>[_(m,{modelValue:t.value.percent,"onUpdate:modelValue":l[0]||(l[0]=s=>t.value.percent=s),type:"number",placeholder:p(e)("百分比"),rules:[{required:!0,message:p(e)("请填写百分比"),max:a.max,min:a.min}]},{button:v(()=>[...l[2]||(l[2]=[c("span",null,"%",-1)])]),_:1},8,["modelValue","placeholder","rules"])]),_:1}),c("div",se,[N(d(n.$t("将选中的商品发布到你的店铺，并填写商品利润比例，推荐比例"))+": ",1),c("span",null,d(a.min)+"%-"+d(a.max)+"%",1)]),c("div",oe,[_(b,{disabled:g.value,block:"",class:"btn-content",type:"primary",onClick:w,"native-type":"submit"},{default:v(()=>[N(d(p(e)("product.26")),1)]),_:1},8,["disabled"])])]),_:1})])]),_:1},8,["show"])],2)}}},me=$(ae,[["__scopeId","data-v-9b0b1348"]]);export{me as e};
