/**
 * name: @web-analytics/core
 * version: v0.1.5
 * description: Website pageview analytics tool for framework-free and multi-analytics-platform support.
 * author: chengpeiquan <chengpeiquan@chengpeiquan.com>
 * homepage: https://analytics.js.org/core/
 * license: MIT
 */
"use strict";var $=Object.defineProperty;var m=(t,e,s)=>e in t?$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var o=(t,e,s)=>(m(t,typeof e!="symbol"?e+"":e,s),s);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const l=require("@bassist/utils"),z="web-analytics-core",v=["baidu","cnzz"];var u=(t=>(t.SetAutoPageview="_setAutoPageview",t.SetAccount="_setAccount",t.TrackPageview="_trackPageview",t.TrackEvent="_trackEvent",t))(u||{});function A({pluginId:t,platform:e,websiteId:s,propertyKey:r,args:n}){const i=[];switch(r){case"loadSdk":{i.push("JS-SDK load done.");break}case"setAccount":{i.push("set account done.");break}case"trackPageview":{const{pageUrl:c,fromUrl:h}=n[0]||{};i.push("track pageview done."),i.push(`pageUrl:      ${d(c)}`),e==="cnzz"&&h&&i.push(`fromUrl:      ${d(h)}`);break}case"trackEvent":{const{category:c,action:h,label:f,value:P,nodeId:_}=n[0]||{};i.push("track event done."),i.push(`category:     ${c}`),i.push(`action:       ${h}`),i.push(`label:        ${g(f)}`),i.push(`value:        ${b(P)}`),e==="cnzz"&&i.push(`nodeId:       ${k(_)}`);break}}i.push(`websiteId:    ${s}`),i.push(`time:         ${new Date}`);const a=i.join(`
`);return`
[${t}] ${l.pascalCase(e)} Analytics ${a}

`}function d(t){if((!t||typeof t!="string")&&(t="/"),t.startsWith("http")){const e=t.split("/"),s=`${e[0]}//${e[2]}`;t=t.replace(s,"")}return t}function S(t){return(!t||t&&typeof t!="string")&&(t=""),typeof t=="string"&&!t.includes("http")&&(t=""),t}function k(t){return(!t||typeof t!="string")&&(t=""),t}function g(t){return(!t||typeof t!="string")&&(t=""),t}function b(t){return(!t||!Number(t))&&(t=1),t}function w(t,e,s){const r=s.value;return s.value=function(...n){const{debug:i,pluginId:a,platform:c,websiteId:h}=this;if(i){const f=A({pluginId:a,platform:c,websiteId:h,propertyKey:e,args:n});console.log(f)}r.apply(this,n)},s}function E(t,e,s){const r=s.value;return s.value=function(...n){const[i]=n,{category:a,action:c}=i;if(typeof a!="string"||typeof c!="string"||!a||!c){this.throwError("Valid `category` and `action` are missing from the track event options.");return}r.apply(this,n)},s}var T=Object.defineProperty,O=Object.getOwnPropertyDescriptor,D=(t,e,s,r)=>{for(var n=r>1?void 0:r?O(e,s):e,i=t.length-1,a;i>=0;i--)(a=t[i])&&(n=(r?a(e,s,n):a(n))||n);return r&&n&&T(e,s,n),n};class I{constructor({pluginId:e,platform:s,websiteId:r,debug:n}){o(this,"pluginId");o(this,"platform");o(this,"sdkInstance");o(this,"sdkUrl","");o(this,"websiteId","");o(this,"debug");this.pluginId=e||z,this.platform=s,this.websiteId=r,this.debug=n??!1,this.updatePlatformInfo(),this.loadSdk()}updatePlatformInfo(){if(l.isBrowser)switch(this.platform){case"baidu":{this.sdkInstance=window._hmt||[],this.sdkUrl=`https://hm.baidu.com/hm.js?${this.websiteId}`;break}case"cnzz":{this.sdkInstance=window._czc||[],this.sdkUrl=`https://v1.cnzz.com/z_stat.php?id=${this.websiteId}&web_id=${this.websiteId}`;break}default:{const e=v.join(", ");this.throwError(`Unsupported platform options, only supported: ${e}.`)}}}loadSdk(){!this.sdkInstance||!this.sdkUrl||(this.sdkInstance.push([u.SetAutoPageview,!1]),l.loadRes({type:"js",id:`${this.pluginId}-${this.platform}-${this.websiteId}`,resource:this.sdkUrl}).catch(e=>{console.log(e)}))}throwError(e){throw new Error(`[${this.pluginId}] ${e}`)}}D([w],I.prototype,"loadSdk",1);var j=Object.defineProperty,L=Object.getOwnPropertyDescriptor,y=(t,e,s,r)=>{for(var n=r>1?void 0:r?L(e,s):e,i=t.length-1,a;i>=0;i--)(a=t[i])&&(n=(r?a(e,s,n):a(n))||n);return r&&n&&j(e,s,n),n};class p extends I{constructor({pluginId:e,platform:s,websiteId:r,debug:n}){super({pluginId:e,platform:s,websiteId:r,debug:n})}setAccount(){this.sdkInstance&&this.sdkInstance.push([u.SetAccount,this.websiteId])}trackPageview({pageUrl:e,fromUrl:s}){if(this.sdkInstance)switch(this.setAccount(),this.platform){case"baidu":{this.sdkInstance.push([u.TrackPageview,d(e)]);break}case"cnzz":{this.sdkInstance.push([u.TrackPageview,d(e),s?S(s):""]);break}}}trackEvent({category:e,action:s,label:r,value:n,nodeId:i}){if(this.sdkInstance)switch(this.setAccount(),this.platform){case"baidu":{this.sdkInstance.push([u.TrackEvent,e,s,g(r),b(n)]);break}case"cnzz":{this.sdkInstance.push([u.TrackEvent,e,s,g(r),b(n),k(i)]);break}}}}y([w],p.prototype,"trackPageview",1);y([w,E],p.prototype,"trackEvent",1);function C(t){return new p({platform:"baidu",...t})}function F(t){return new p({platform:"cnzz",...t})}exports.Analytics=p;exports.SUPPORTED_ANALYTICS_PLATFORMS=v;exports.createBaiduAnalytics=C;exports.createCnzzAnalytics=F;
