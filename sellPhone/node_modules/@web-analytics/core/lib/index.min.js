/**
 * name: @web-analytics/core
 * version: v0.1.5
 * description: Website pageview analytics tool for framework-free and multi-analytics-platform support.
 * author: chengpeiquan <chengpeiquan@chengpeiquan.com>
 * homepage: https://analytics.js.org/core/
 * license: MIT
 */
(function(r,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("@bassist/utils")):typeof define=="function"&&define.amd?define(["exports","@bassist/utils"],c):(r=typeof globalThis<"u"?globalThis:r||self,c(r.Core={},r["@bassist/utils"]))})(this,function(r,c){"use strict";var F=Object.defineProperty;var M=(r,c,h)=>c in r?F(r,c,{enumerable:!0,configurable:!0,writable:!0,value:h}):r[c]=h;var d=(r,c,h)=>(M(r,typeof c!="symbol"?c+"":c,h),h);const h="web-analytics-core",I=["baidu","cnzz"];var p=(t=>(t.SetAutoPageview="_setAutoPageview",t.SetAccount="_setAccount",t.TrackPageview="_trackPageview",t.TrackEvent="_trackEvent",t))(p||{});function _({pluginId:t,platform:e,websiteId:n,propertyKey:a,args:s}){const i=[];switch(a){case"loadSdk":{i.push("JS-SDK load done.");break}case"setAccount":{i.push("set account done.");break}case"trackPageview":{const{pageUrl:u,fromUrl:f}=s[0]||{};i.push("track pageview done."),i.push(`pageUrl:      ${b(u)}`),e==="cnzz"&&f&&i.push(`fromUrl:      ${b(f)}`);break}case"trackEvent":{const{category:u,action:f,label:k,value:C,nodeId:L}=s[0]||{};i.push("track event done."),i.push(`category:     ${u}`),i.push(`action:       ${f}`),i.push(`label:        ${g(k)}`),i.push(`value:        ${w(C)}`),e==="cnzz"&&i.push(`nodeId:       ${y(L)}`);break}}i.push(`websiteId:    ${n}`),i.push(`time:         ${new Date}`);const o=i.join(`
`);return`
[${t}] ${c.pascalCase(e)} Analytics ${o}

`}function b(t){if((!t||typeof t!="string")&&(t="/"),t.startsWith("http")){const e=t.split("/"),n=`${e[0]}//${e[2]}`;t=t.replace(n,"")}return t}function $(t){return(!t||t&&typeof t!="string")&&(t=""),typeof t=="string"&&!t.includes("http")&&(t=""),t}function y(t){return(!t||typeof t!="string")&&(t=""),t}function g(t){return(!t||typeof t!="string")&&(t=""),t}function w(t){return(!t||!Number(t))&&(t=1),t}function v(t,e,n){const a=n.value;return n.value=function(...s){const{debug:i,pluginId:o,platform:u,websiteId:f}=this;if(i){const k=_({pluginId:o,platform:u,websiteId:f,propertyKey:e,args:s});console.log(k)}a.apply(this,s)},n}function z(t,e,n){const a=n.value;return n.value=function(...s){const[i]=s,{category:o,action:u}=i;if(typeof o!="string"||typeof u!="string"||!o||!u){this.throwError("Valid `category` and `action` are missing from the track event options.");return}a.apply(this,s)},n}var A=Object.defineProperty,T=Object.getOwnPropertyDescriptor,S=(t,e,n,a)=>{for(var s=a>1?void 0:a?T(e,n):e,i=t.length-1,o;i>=0;i--)(o=t[i])&&(s=(a?o(e,n,s):o(s))||s);return a&&s&&A(e,n,s),s};class P{constructor({pluginId:e,platform:n,websiteId:a,debug:s}){d(this,"pluginId");d(this,"platform");d(this,"sdkInstance");d(this,"sdkUrl","");d(this,"websiteId","");d(this,"debug");this.pluginId=e||h,this.platform=n,this.websiteId=a,this.debug=s??!1,this.updatePlatformInfo(),this.loadSdk()}updatePlatformInfo(){if(c.isBrowser)switch(this.platform){case"baidu":{this.sdkInstance=window._hmt||[],this.sdkUrl=`https://hm.baidu.com/hm.js?${this.websiteId}`;break}case"cnzz":{this.sdkInstance=window._czc||[],this.sdkUrl=`https://v1.cnzz.com/z_stat.php?id=${this.websiteId}&web_id=${this.websiteId}`;break}default:{const e=I.join(", ");this.throwError(`Unsupported platform options, only supported: ${e}.`)}}}loadSdk(){!this.sdkInstance||!this.sdkUrl||(this.sdkInstance.push([p.SetAutoPageview,!1]),c.loadRes({type:"js",id:`${this.pluginId}-${this.platform}-${this.websiteId}`,resource:this.sdkUrl}).catch(e=>{console.log(e)}))}throwError(e){throw new Error(`[${this.pluginId}] ${e}`)}}S([v],P.prototype,"loadSdk",1);var E=Object.defineProperty,O=Object.getOwnPropertyDescriptor,m=(t,e,n,a)=>{for(var s=a>1?void 0:a?O(e,n):e,i=t.length-1,o;i>=0;i--)(o=t[i])&&(s=(a?o(e,n,s):o(s))||s);return a&&s&&E(e,n,s),s};class l extends P{constructor({pluginId:e,platform:n,websiteId:a,debug:s}){super({pluginId:e,platform:n,websiteId:a,debug:s})}setAccount(){this.sdkInstance&&this.sdkInstance.push([p.SetAccount,this.websiteId])}trackPageview({pageUrl:e,fromUrl:n}){if(this.sdkInstance)switch(this.setAccount(),this.platform){case"baidu":{this.sdkInstance.push([p.TrackPageview,b(e)]);break}case"cnzz":{this.sdkInstance.push([p.TrackPageview,b(e),n?$(n):""]);break}}}trackEvent({category:e,action:n,label:a,value:s,nodeId:i}){if(this.sdkInstance)switch(this.setAccount(),this.platform){case"baidu":{this.sdkInstance.push([p.TrackEvent,e,n,g(a),w(s)]);break}case"cnzz":{this.sdkInstance.push([p.TrackEvent,e,n,g(a),w(s),y(i)]);break}}}}m([v],l.prototype,"trackPageview",1),m([v,z],l.prototype,"trackEvent",1);function D(t){return new l({platform:"baidu",...t})}function j(t){return new l({platform:"cnzz",...t})}r.Analytics=l,r.SUPPORTED_ANALYTICS_PLATFORMS=I,r.createBaiduAnalytics=D,r.createCnzzAnalytics=j,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
