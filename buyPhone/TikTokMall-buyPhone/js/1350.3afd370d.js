"use strict";(self["webpackChunkshop"]=self["webpackChunkshop"]||[]).push([[1350],{48041:function(t,e,i){i(76952),i(98992),i(22795)},54365:function(t,e,i){i(44114),i(18111),i(7588),i(61701);var o=i(55685),a=i(83462),s=i(48499),n=i(28722),r=i(77965),l=i(96874),c=(0,o.Y)("rate"),u=c[0],d=c[1];function h(t,e,i){return t>=e?"full":t+.5>=e&&i?"half":"void"}e.A=u({mixins:[n.B,r.Y],props:{size:[Number,String],color:String,gutter:[Number,String],readonly:Boolean,disabled:Boolean,allowHalf:Boolean,voidColor:String,iconPrefix:String,disabledColor:String,value:{type:Number,default:0},icon:{type:String,default:"star"},voidIcon:{type:String,default:"star-o"},count:{type:[Number,String],default:5},touchable:{type:Boolean,default:!0}},computed:{list:function(){for(var t=[],e=1;e<=this.count;e++)t.push(h(this.value,e,this.allowHalf));return t},sizeWithUnit:function(){return(0,a._)(this.size)},gutterWithUnit:function(){return(0,a._)(this.gutter)}},mounted:function(){this.bindTouchEvent(this.$el)},methods:{select:function(t){this.disabled||this.readonly||t===this.value||(this.$emit("input",t),this.$emit("change",t))},onTouchStart:function(t){var e=this;if(!this.readonly&&!this.disabled&&this.touchable){this.touchStart(t);var i=this.$refs.items.map(function(t){return t.getBoundingClientRect()}),o=[];i.forEach(function(t,i){e.allowHalf?o.push({score:i+.5,left:t.left},{score:i+1,left:t.left+t.width/2}):o.push({score:i+1,left:t.left})}),this.ranges=o}},onTouchMove:function(t){if(!this.readonly&&!this.disabled&&this.touchable&&(this.touchMove(t),"horizontal"===this.direction)){(0,s.wo)(t);var e=t.touches[0].clientX;this.select(this.getScoreByPosition(e))}},getScoreByPosition:function(t){for(var e=this.ranges.length-1;e>0;e--)if(t>this.ranges[e].left)return this.ranges[e].score;return this.allowHalf?.5:1},genStar:function(t,e){var i,o=this,a=this.$createElement,s=this.icon,n=this.color,r=this.count,c=this.voidIcon,u=this.disabled,h=this.voidColor,f=this.disabledColor,p=e+1,m="full"===t,g="void"===t;return this.gutterWithUnit&&p!==+r&&(i={paddingRight:this.gutterWithUnit}),a("div",{ref:"items",refInFor:!0,key:e,attrs:{role:"radio",tabindex:"0","aria-setsize":r,"aria-posinset":p,"aria-checked":String(!g)},style:i,class:d("item")},[a(l.A,{attrs:{size:this.sizeWithUnit,name:m?s:c,color:u?f:m?n:h,classPrefix:this.iconPrefix,"data-score":p},class:d("icon",{disabled:u,full:m}),on:{click:function(){o.select(p)}}}),this.allowHalf&&a(l.A,{attrs:{size:this.sizeWithUnit,name:g?c:s,color:u?f:g?h:n,classPrefix:this.iconPrefix,"data-score":p-.5},class:d("icon",["half",{disabled:u,full:!g}]),on:{click:function(){o.select(p-.5)}}})])}},render:function(){var t=this,e=arguments[0];return e("div",{class:d({readonly:this.readonly,disabled:this.disabled}),attrs:{tabindex:"0",role:"radiogroup"}},[this.list.map(function(e,i){return t.genStar(e,i)})])}})},57744:function(t,e,i){i.r(e),i.d(e,{default:function(){return v}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"page-content"},[e("van-nav-bar",{attrs:{"safe-area-inset-top":"",fixed:"",title:t.$t("评价"),"left-arrow":""},on:{"click-left":()=>t.$router.back()}}),e("div",{staticStyle:{width:"100%",height:"46px"}}),t.goodsData.length?e("div",{staticClass:"evaluate-content"},[t._l(t.goodsData,function(i,o){return e("div",{key:o,staticClass:"item"},[e("div",{staticClass:"goods-info"},[e("div",{staticClass:"poster"},[e("img",{attrs:{src:i.goodsIcon,alt:""}})]),e("div",{staticClass:"info"},[e("p",{staticClass:"name"},[t._v(t._s(i.goodsName?.length>27?i.goodsName.slice(0,27)+"...":i.goodsName))]),e("p",{staticClass:"price"},[t._v("$ "+t._s(t.priceFormat(i.goodsReal)))]),e("van-rate",{staticClass:"rate-wrap",attrs:{size:15,":color":t.mainColor,"void-icon":"star","void-color":"#D9D9D9"},model:{value:i.rating,callback:function(e){t.$set(i,"rating",e)},expression:"item.rating"}})],1)]),e("el-input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:4},placeholder:t.$t("请输入评价信息"),resize:"none",maxlength:"1000","show-word-limit":""},model:{value:i.content,callback:function(e){t.$set(i,"content",e)},expression:"item.content"}}),e("div",{staticClass:"evaluate-title"},[t._v(t._s(t.$t("评价晒图")))]),e("van-uploader",{attrs:{"after-read":t.afterRead,name:o,"max-count":9,accept:".png,.jpg,.jpeg"},model:{value:i.fileList,callback:function(e){t.$set(i,"fileList",e)},expression:"item.fileList"}})],1)}),e("div",{staticClass:"submit-btn",on:{click:t.submitHandle}},[t._v(t._s(t.$t("提交评论")))])],2):t._e()],1)},a=[],s=(i(99809),i(51785)),n=(i(48041),i(54365)),r=(i(74884),i(91981)),l=(i(64258),i(31864)),c=(i(18111),i(7588),i(61701),i(97797)),u=i(23808),d=i(77069),h=i(94348),f={name:"OrderEvaluate",components:{[l.A.name]:l.A,[r.A.name]:r.A,[n.A.name]:n.A,[s.A.name]:s.A},data(){return{mainColor:"#f89900",fileList:[],cancelShow:!1,remindShow:!1,currentData:null,orderId:null,goodsData:[]}},mounted(){this.$nextTick(()=>{const{id:t}=this.$route.query;t?(this.orderId=t,this.getOrderGoods()):((0,r.A)(this.$t("订单号不存在")),setTimeout(()=>{this.$router.back()},1500))})},methods:{afterRead(t,{name:e}){let i=this.goodsData[e].fileList.length;r.A.loading({duration:0,message:this.$t("上传中"),forbidClick:!0});let o=new FormData;o.append("file",t.file),o.append("moduleName","selle");(0,d.D6)(o).then(t=>{h.log("图片上传成功",t),this.goodsData[e][`imgUrl${i}`]=t}).catch(t=>{this.fileList=[],this.$notify(this.$t("上传失败"))}).finally(()=>{r.A.clear()})},priceFormat(t){return(0,u.XV)(t)},getOrderGoods(){r.A.loading({duration:0,message:this.$t("请求中"),forbidClick:!0}),(0,c.X2)({orderId:this.orderId}).then(t=>{const e=t.pageList||[];e.forEach(t=>{t.rating=5,t.content=""}),this.goodsData=e,r.A.clear()}).catch(()=>{r.A.clear()})},async submitHandle(){const t=this.goodsData.map(t=>{const{rating:e,content:i,goodsId:o}=t;let a="1";a=e<2?"3":e<4?"2":"1";let s={orderId:this.orderId,sellerGoodsId:o,rating:e,content:i,evaluationType:a};return Object.keys(t).forEach(e=>{-1!==e.indexOf("imgUrl")&&(s[e]=t[e])}),s});r.A.loading({duration:0,message:this.$t("提交中"),forbidClick:!0});for(let e=0;e<t.length;e++)await(0,c.IN)(t[e]);r.A.success(this.$t("成功")),setTimeout(()=>{this.$router.back()},1e3)}}},p=f,m=i(81656),g=(0,m.A)(p,o,a,!1,null,"b97da806",null),v=g.exports},77069:function(t,e,i){i.d(e,{$U:function(){return c},BS:function(){return h},CS:function(){return m},D6:function(){return d},DG:function(){return u},J$:function(){return l},O2:function(){return n},OX:function(){return f},RR:function(){return r},Rv:function(){return p},Tu:function(){return g},a9:function(){return a},bl:function(){return s}});var o=i(63793);const a=t=>(0,o.A)({url:"api/sellerGoods!info.action",method:"post",params:t}),s=t=>(0,o.A)({url:"/api/evaluation!list.action",method:"post",params:t}),n=t=>(0,o.A)({url:"api/seller!info.action",method:"post",params:t}),r=t=>(0,o.A)({url:"api/order!submit.action",method:"post",params:t}),l=t=>(0,o.A)({url:"api/order!pay.action",method:"post",params:t}),c=t=>(0,o.A)({url:"api/order!info.action",method:"post",params:t}),u=t=>(0,o.A)({url:"/seller/version!register.action",method:"post",params:t}),d=t=>(0,o.A)({url:"api/uploadimg!execute.action",method:"post",data:t}),h=t=>(0,o.A)({url:"api/kyc!get.action",method:"post",params:t}),f=t=>(0,o.A)({url:"api/keepGoods!add.action",method:"post",params:t}),p=t=>(0,o.A)({url:"api/keepGoods!del.action",method:"post",params:t}),m=t=>(0,o.A)({url:"api/evaluation!countType.action",method:"post",params:t}),g=t=>(0,o.A)({url:"api/sellerGoods!recommend_like.action",method:"post",params:t})}}]);