"use strict";(self["webpackChunkshop"]=self["webpackChunkshop"]||[]).push([[992],{10300:function(t,s,i){i.r(s),i.d(s,{default:function(){return v}});var e=function(){var t=this,s=t._self._c;return s("div",{staticClass:"search-container",staticStyle:{"min-height":"100vh"}},[s("van-nav-bar",{attrs:{"safe-area-inset-top":"",fixed:"","left-arrow":"","right-text":t.$t("搜索")},on:{"click-right":t.searchView,"click-left":function(s){return t.$router.go(-1)}},scopedSlots:t._u([{key:"title",fn:function(){return[s("van-search",{attrs:{shape:"round",clearable:!1,placeholder:t.$t("找货源/商品/供应商/求购")},on:{input:t.inputHandle},scopedSlots:t._u([{key:"left-icon",fn:function(){return[s("img",{staticClass:"search-icon",attrs:{src:t.searchIcon,alt:""},on:{click:t.searchHandle}})]},proxy:!0},{key:"right-icon",fn:function(){return[t.keyword?s("van-icon",{attrs:{name:"cross",size:"14",color:"#333333"},on:{click:t.clearHandle}}):t._e()]},proxy:!0}]),model:{value:t.keyword,callback:function(s){t.keyword=s},expression:"keyword"}})]},proxy:!0}])}),s("div",{staticStyle:{width:"100%",height:"44px"}}),t.tipsShow||t.shopShow||t.listShow?t._e():s("div",{staticClass:"search-history"},[s("div",{staticClass:"title"},[s("p",[t._v(t._s(t.$t("历史搜索")))]),t.searchHistory1.length?s("div",{staticClass:"clear",on:{click:t.emptyHandle}},[s("img",{staticClass:"search-icon",attrs:{src:t.clearIcon,alt:""}}),s("p",[t._v(t._s(t.$t("清空")))])]):t._e()]),t.searchHistory1.length?s("div",{staticClass:"content"},t._l(t.searchHistory1,function(i,e){return s("div",{key:e,staticClass:"item",on:{click:function(s){return t.tipsHandle(i,!1)}}},[t._v(" "+t._s(i)+" ")])}),0):s("van-empty",{attrs:{description:t.$t("暂无记录")}})],1),t.tipsShow?s("div",{staticClass:"search-tips-content"},[t.tipsData.length?t._l(t.tipsData,function(i,e){return s("div",{key:e,staticClass:"item",on:{click:function(s){return t.tipsHandle(i,i.isShop)}}},[i.isShop?s("van-icon",{attrs:{name:"shop-o",size:"18"}}):t._e(),s("p",[t._v(t._s(i.name))])],1)}):s("van-empty",{attrs:{description:t.$t("暂无数据")}})],2):t._e(),t.listShow?s("div",{staticClass:"search-result-content"},[s("div",{staticStyle:{padding:"0 15px"}},[s("goods-content-one",{attrs:{"goods-data":t.listData}}),t.listData.length||t.listLoading||t.loading?t._e():s("van-empty",{attrs:{description:t.$t("暂无数据")}})],1)]):t._e(),t.shopShow?s("div",{staticClass:"shop-list-content"},["en"===t.activeLang?s("div",{staticClass:"tips"},[t._v(" Find "+t._s(t.shopData.length)+" "),s("span",[t._v('"'+t._s(t.keyword))]),t._v('" related stores for you ')]):s("div",{staticClass:"tips"},[t._v(" "+t._s(t.$t("为您找到"))+" "),s("span",[t._v('"'+t._s(t.keyword))]),t._v('" '+t._s(t.$t("相关的店铺"))+" "+t._s(t.shopData.length||0)+" "+t._s(t.$t("家"))+" ")]),s("shop-content-two",{attrs:{"shop-data":t.shopData}})],1):t._e()],1)},a=[],o=(i(74884),i(91981)),h=(i(37302),i(76411)),r=(i(63212),i(96874)),n=(i(7287),i(10339)),c=(i(327),i(15283)),l=(i(4624),i(36790)),d=(i(17642),i(58004),i(33853),i(45876),i(32475),i(15024),i(31698),i(82957)),p=i(29425),g=i(93518),y=i(12952),u=i.n(y),S=i(34931),w={name:"Search",components:{[l.A.name]:l.A,[c.A.name]:c.A,[n.A.name]:n.A,[r.A.name]:r.A,[h.A.name]:h.A,[o.A.name]:o.A,GoodsContentOne:d.A,ShopContentTwo:p.A},data(){return{searchIcon:i(51211),clearIcon:i(23959),keyword:"",tipsShow:!1,tipsData:[],shopData:[],shopShow:!1,listData:[],listShow:!1,listLoading:!1,loading:!1,finished:!1,refreshing:!1,pageNum:1,pageSize:20,currentGoodsId:null,searchHistory1:[]}},computed:{...(0,g.L8)({searchHistory:"searchHistory",activeLang:"language"})},watch:{$route(t,s){"CommodityDetails"==t.path&&sessionStorage.setItem("searchList",this.listData),"CommodityDetails"==s.path&&(this.listData=sessionStorage.getItem("searchList"))}},mounted(){this.searchHistory1=JSON.parse(localStorage.getItem("searchHistory1"))||[],this.searchHistory1=[...new Set(this.searchHistory1)]},methods:{onRefresh(){this.finished=!1,this.pageNum=1,this.loading=!0,this.onLoad()},onLoad(){this.refreshing&&(this.list=[],this.refreshing=!1),this.getListData()},getListData(){this.currentGoodsId?(0,S.QQ)({goodsId:this.currentGoodsId,pageNum:this.pageNum,pageSize:this.pageSize}).then(t=>{const{pageList:s}=t;this.listData=1===this.pageNum?s:[...this.listData,...s],this.pageNum++,this.loading=!1,s.length<this.pageSize&&(this.finished=!0),this.listLoading=!1,o.A.clear()}).catch(()=>{this.loading=!1,this.listLoading=!1,o.A.clear()}):(this.listLoading=!1,this.finished=!0,o.A.clear(),this.listData=[])},tipsHandle(t,s){if(o.A.loading({duration:0,message:this.$t("加载中")}),"string"==typeof t)return this.keyword=t,void this.searchHandle();let i=String(this.keyword).trim();s?(this.shopShow=!0,this.tipsShow=!1,this.listShow=!1,this.searchHistory1.unshift(t.keyword),this.searchHistory1=[...new Set(this.searchHistory1)],localStorage.setItem("searchHistory1",JSON.stringify(this.searchHistory1)),(0,S.Y6)({keyword:i,isHot:"0",isPrice:"0",isNew:"0"}).then(t=>{this.shopData=t.sellerList,o.A.clear()})):(this.searchHistory1.unshift(t.name),this.searchHistory1=[...new Set(this.searchHistory1)],localStorage.setItem("searchHistory1",JSON.stringify(this.searchHistory1)),this.listShow=!0,this.tipsShow=!1,this.shopShow=!1,this.keyword=t.name,this.currentGoodsId=t.goodsId,this.$store.dispatch("setSearchHistory",{name:t.name,goodsId:t.goodsId}),o.A.loading({duration:0,message:this.$t("加载中")}),this.pageNum=1,this.finished=!1,this.loading=!0,this.listLoading=!0,this.refreshing=!0,this.listData=[],this.onLoad())},clearHandle(){this.tipsShow=!1,this.listShow=!1,this.shopShow=!1,this.keyword=""},inputHandle:u()(function(){this.searchHandle()},1e3),searchView(){if(""==this.keyword.trim())return this.$notify(this.$t("请输入搜索内容"),"warning");o.A.loading({duration:0,message:this.$t("加载中")}),this.listData=[],this.tipsShow=!1,this.listShow=!0,this.shopShow=!1,this.searchHistory1.unshift(this.keyword.trim()),this.searchHistory1=[...new Set(this.searchHistory1)],localStorage.setItem("searchHistory1",JSON.stringify(this.searchHistory1));let t=String(this.keyword).trim(),s=localStorage.getItem("lang");s=s.replace(/"/g,""),(0,S.Et)({keyword:t,lang:s,discount:this.$route.query.discount||0}).then(t=>{const{pageList:s,pageInfo:i}=t;this.listData=s,o.A.clear()})},searchHandle(){let t=String(this.keyword).trim();if(""==t&&(this.tipsData=[],(0,o.A)(this.$t("请输入搜索内容"))),this.tipsShow=!0,this.listShow=!1,this.shopShow=!1,t){this.tipsData=[];let s=localStorage.getItem("lang");s=s.replace(/"/g,""),(0,S.Y6)({keyword:t,lang:s,discount:this.$route.query.discount||0}).then(s=>{const{goodsList:i,pageInfo:e}=s,a={keyword:t,name:`"${t}" ${this.$t("相关的店铺")}`,isShop:!0};this.listData=i,this.tipsData=[a,...i],o.A.clear()}).catch(t=>{o.A.clear()})}else this.tipsShow=!1,this.listShow=!1,this.shopShow=!1},emptyHandle(){this.$store.dispatch("clearSearchHistory"),localStorage.removeItem("searchHistory1"),this.searchHistory1=[]}}},m=w,f=i(81656),H=(0,f.A)(m,e,a,!1,null,"ebf0d442",null),v=H.exports}}]);